---
sidebar_position: 20
title: "ğŸ’¡ ç‰¹æ®Šå‚æ•°"
---

:::warning
æœ¬æ•™ç¨‹ç”±ç¤¾åŒºè´¡çŒ®ï¼Œä¸ç”± Open WebUI å›¢é˜Ÿæ”¯æŒã€‚å®ƒä»…ä½œä¸ºè‡ªå®šä¹‰ Open WebUI ä»¥æ»¡è¶³æ‚¨çš„ç‰¹å®šç”¨ä¾‹çš„ç¤ºä¾‹ã€‚æƒ³è¦è´¡çŒ®ï¼ŸæŸ¥çœ‹è´¡çŒ®æ•™ç¨‹ã€‚
:::

# ğŸ’¡ ç‰¹æ®Šå‚æ•°

åœ¨å¼€å‘æ‚¨è‡ªå·±çš„ `å·¥å…·`ã€`å‡½æ•°`ï¼ˆå¦‚`è¿‡æ»¤å™¨`ã€`ç®¡é“`æˆ–`æ“ä½œ`ï¼‰ã€`ç®¡é“`ç­‰æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç‰¹æ®Šå‚æ•°æ¥æ¢ç´¢ Open-WebUI çš„å…¨éƒ¨åŠŸèƒ½ã€‚

æœ¬é¡µé¢æ—¨åœ¨è¯¦ç»†è¯´æ˜æ¯ç§ç‰¹æ®Šå‚æ•°çš„ç±»å‹å’Œç»“æ„ï¼Œå¹¶æä¾›ç¤ºä¾‹ã€‚

### `body`

`dict` é€šå¸¸ç›´æ¥ä¼ é€’ç»™æ¨¡å‹ã€‚è™½ç„¶å®ƒå¹¶ä¸ä¸¥æ ¼æ˜¯ä¸€ä¸ªç‰¹æ®Šå‚æ•°ï¼Œä½†ä¸ºäº†ä¾¿äºå‚è€ƒå¹¶å› ä¸ºå®ƒè‡ªèº«åŒ…å«ä¸€äº›ç‰¹æ®Šå‚æ•°ï¼Œå› æ­¤åœ¨è¿™é‡ŒåŒ…æ‹¬å®ƒã€‚

<details>
<summary>ç¤ºä¾‹</summary>

```json

{
  "stream": true,
  "model": "my-cool-model",
  # å°å†™å­—ç¬¦ä¸²ï¼Œå•è¯ä¹‹é—´ä»¥ - åˆ†éš”ï¼šè¿™æ˜¯æ¨¡å‹çš„ ID
  "messages": [
    {
      "role": "user",
      "content": [
        {
          "type": "text",
          "text": "è¿™å¼ å›¾ç‰‡ä¸­æœ‰ä»€ä¹ˆï¼Ÿ"
        },
        {
          "type": "image_url",
          "image_url": {
            "url": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdYAAAGcCAYAAABk2YF[REDACTED]"
            # å›¾åƒä»¥ base64 ç¼–ç æ•°æ®å½¢å¼ä¼ é€’
          }
        }
      ]
    },
    {
      "role": "assistant",
      "content": "è¿™å¼ å›¾ç‰‡çœ‹èµ·æ¥æ˜¯ [REDACTED]"
    },
  ],
  "features": {
    "image_generation": false,
    "code_interpreter": false,
    "web_search": false
  },
  "stream_options": {
    "include_usage": true
  },
  "metadata": "[ä¸ __metadata__ å®Œå…¨ç›¸åŒçš„å­—å…¸]",
  "files": "[ä¸ __files__ å®Œå…¨ç›¸åŒçš„åˆ—è¡¨]"
}


```

</details>

### `__user__`

åŒ…å«ç”¨æˆ·ä¿¡æ¯çš„ `dict`ã€‚

è¯·æ³¨æ„ï¼Œå¦‚æœå®šä¹‰äº† `UserValves` ç±»ï¼Œå…¶å®ä¾‹éœ€è¦é€šè¿‡ `__user__["valves"]` è®¿é—®ã€‚å¦åˆ™ï¼Œ`valves` é”®å€¼åœ¨ `__user__` ä¸­å®Œå…¨ç¼ºå¤±ã€‚

<details>
<summary>ç¤ºä¾‹</summary>

```json
{
  "id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "email": "cheesy_dude@openwebui.com",
  "name": "Patrick",
  "role": "user",
  # è§’è‰²å¯ä»¥æ˜¯ `user` æˆ– `admin`
  "valves": "[UserValve å®ä¾‹]"
}
```

</details>

### `__metadata__`

åŒ…å«å…³äºèŠå¤©ã€æ¨¡å‹ã€æ–‡ä»¶ç­‰å¹¿æ³›ä¿¡æ¯çš„ `dict`ã€‚

<details>
<summary>ç¤ºä¾‹</summary>

```json
{
  "user_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "chat_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "message_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "session_id": "xxxxxxxxxxxxxxxxxxxx",
  "tool_ids": null,
  # tool_ids æ˜¯å­—ç¬¦ä¸²åˆ—è¡¨ã€‚
  "tool_servers": [],
  "files": "[ä¸ body['files'] ç›¸åŒ]",
  # å¦‚æœæœªæä¾›æ–‡ä»¶ï¼Œfiles é”®å°†å­˜åœ¨äº __metadata__ ä¸­ï¼Œå…¶å€¼ä¸ºç©º []
  "features": {
    "image_generation": false,
    "code_interpreter": false,
    "web_search": false
  },
  "variables": {
    "{{USER_NAME}}": "cheesy_username",
    "{{USER_LOCATION}}": "Unknown",
    "{{CURRENT_DATETIME}}": "2025-02-02 XX:XX:XX",
    "{{CURRENT_DATE}}": "2025-02-02",
    "{{CURRENT_TIME}}": "XX:XX:XX",
    "{{CURRENT_WEEKDAY}}": "æ˜ŸæœŸä¸€",
    "{{CURRENT_TIMEZONE}}": "æ¬§æ´²/æŸæ—",
    "{{USER_LANGUAGE}}": "en-US"
  },
  "model": "[ä¸ __model__ å®Œå…¨ç›¸åŒçš„å­—å…¸]",
  "direct": false,
  "function_calling": "native",
  "type": "user_response",
  "interface": "open-webui"
}

```

</details>

### `__model__`

åŒ…å«å…³äºæ¨¡å‹ä¿¡æ¯çš„ `dict`ã€‚

<details>
<summary>ç¤ºä¾‹</summary>

```json
{
  "id": "my-cool-model",
  "name": "æˆ‘çš„é…·æ¨¡å‹",
  "object": "æ¨¡å‹",
  "created": 1746000000,
  "owned_by": "openai",
  # å¯ä»¥æ˜¯ openai æˆ– ollama
  "info": {
      "id": "my-cool-model",
      "user_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
      "base_model_id": "gpt-4o",
      # è¿™æ˜¯æ¨¡å‹ç«¯ç‚¹æä¾›çš„æ¨¡å‹åç§°
      "name": "æˆ‘çš„é…·æ¨¡å‹",
      "params": {
      "system": "ä½ æ˜¯æˆ‘æœ€å¥½çš„åŠ©æ‰‹ã€‚ä½ å›ç­” [REDACTED]",
      "function_calling": "native"
      # è‡ªå®šä¹‰é€‰é¡¹å‡ºç°åœ¨è¿™é‡Œï¼Œä¾‹å¦‚ "Top K"
      },
      "meta": {
      "profile_image_url": "/static/favicon.png",
      "description": "my-cool-model çš„æè¿°",
      "capabilities": {
          "vision": true,
          "usage": true,
          "citations": true
      },
      "position": 17,
      "tags": [
          {
          "name": "for_friends"
          },
          {
          "name": "vision_enabled"
          }
      ],
      "suggestion_prompts": null
      },
      "access_control": {
      "read": {
          "group_ids": [],
          "user_ids": []
      },
      "write": {
          "group_ids": [],
          "user_ids": []
      }
      },
      "is_active": true,
      "updated_at": 1740000000,
      "created_at": 1740000000
  },
  "preset": true,
  "actions": [],
  "tags": [
      {
          "name": "for_friends"
      },
{
          "name": "å¯ç”¨è§†è§‰ï¼ˆvision_enabledï¼‰"
      }
  ]
}

```

</details>

### `__æ¶ˆæ¯__`

ä¸€ä¸ªåŒ…å«å…ˆå‰æ¶ˆæ¯çš„ `åˆ—è¡¨`ã€‚

è¯·å‚é˜…ä¸Šè¿° `body["messages"]` çš„å€¼ã€‚


### `__èŠå¤©ID__`

`chat_id` çš„ `å­—ç¬¦ä¸²`ã€‚

è¯·å‚é˜…ä¸Šè¿° `__metadata__["chat_id"]` çš„å€¼ã€‚

### `__ä¼šè¯ID__`

`session_id` çš„ `å­—ç¬¦ä¸²`ã€‚

è¯·å‚é˜…ä¸Šè¿° `__metadata__["session_id"]` çš„å€¼ã€‚

### `__æ¶ˆæ¯ID__`

`message_id` çš„ `å­—ç¬¦ä¸²`ã€‚

è¯·å‚é˜…ä¸Šè¿° `__metadata__["message_id"]` çš„å€¼ã€‚

### `__äº‹ä»¶å‘å°„å™¨__`

ç”¨äºå‘ç”¨æˆ·å±•ç¤ºäº‹ä»¶ä¿¡æ¯çš„ `å¯è°ƒç”¨å¯¹è±¡`ã€‚

### `__äº‹ä»¶è°ƒç”¨__`

ç”¨äº `åŠ¨ä½œ` çš„ `å¯è°ƒç”¨å¯¹è±¡`ã€‚

### `__æ–‡ä»¶__`

ä¸€ä¸ªé€šè¿‡èŠå¤©å‘é€çš„æ–‡ä»¶ `åˆ—è¡¨`ã€‚è¯·æ³¨æ„ï¼Œå›¾ç‰‡ä¸è¢«è§†ä¸ºæ–‡ä»¶ï¼Œå¹¶ä¼šç›´æ¥ä½œä¸º `body["messages"]` åˆ—è¡¨çš„ä¸€éƒ¨åˆ†å‘é€è‡³æ¨¡å‹ã€‚

æ–‡ä»¶çš„å®é™…äºŒè¿›åˆ¶æ•°æ®ä¸ä¼šä½œä¸ºå‚æ•°çš„ä¸€éƒ¨åˆ†å‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œä½†å¦‚æœéœ€è¦ä»ç„¶å¯ä»¥é€šè¿‡å…¶è·¯å¾„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ `docker` æ—¶ï¼Œè·å–è·¯å¾„çš„ Python ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```python
from pathlib import Path

the_file = Path(f"/app/backend/data/uploads/{__files__[0]["files"]["id"]}_{__files__[0]["files"]["filename"]}")
assert the_file.exists()
```

è¯·æ³¨æ„ï¼ŒåŒæ ·çš„æ–‡ä»¶å­—å…¸ä¹Ÿå¯ä»¥é€šè¿‡ `__metadata__["files"]` è®¿é—®ï¼ˆå…¶å€¼ä¸º `[]` å¦‚æœæ²¡æœ‰æ–‡ä»¶è¢«å‘é€ï¼‰ï¼Œæˆ–è€…é€šè¿‡ `body["files"]` è®¿é—®ï¼ˆä½†å¦‚æœæ²¡æœ‰æ–‡ä»¶è¢«å‘é€ï¼Œåˆ™ `body` ä¸­ä¼šå®Œå…¨ç¼ºå°‘ `files` é”®ï¼‰ã€‚

<details>
<summary>ç¤ºä¾‹</summary>

```json

[
  {
    "type": "æ–‡ä»¶",
    "file": {
      "id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
      "filename": "Napoleon - Wikipedia.pdf",
      "user_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
      "hash": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
      "data": {
        "content": "Napoleon - Wikipedia\n\n\nNapoleon I\n\nThe Emperor Napoleon in His Study at the\nTuileries, 1812\n\nEmperor of the French\n\n1st reign 18 May 1804 â€“ 6 April 1814\n\nSuccessor Louis XVIII[a]\n\n2nd reign 20 March 1815Â â€“ 22Â June 1815\n\nSuccessor Louis XVIII[a]\n\nFirst Consul of the French Republic\n\nIn office\n13 December 1799Â â€“ 18 May 1804\n\nBorn Napoleone Buonaparte\n15 August 1769\nAjaccio, Corsica, Kingdom of\nFrance\n\nDied 5 May 1821 (agedÂ 51)\nLongwood, Saint Helena\n\nBurial 15 December 1840\nLes Invalides, Paris\n\nNapoleon\nNapoleon Bonaparte[b] (born Napoleone\nBuonaparte;[1][c] 15 August 1769 â€“ 5 May 1821), later\nknown [REDACTED]",
        # å†…å®¹å€¼æ¥æºäºæ–‡æ¡£è§£æå™¨ï¼Œä»¥ä¸Šç¤ºä¾‹ä¸ºä½¿ç”¨ Tika ä½œä¸ºæ–‡æ¡£è§£æå™¨
      },
      "meta": {
        "name": "Napoleon - Wikipedia.pdf",
        "content_type": "åº”ç”¨ç¨‹åº/pdf",
        "size": 10486578,
        # å•ä½ä¸ºå­—èŠ‚ï¼Œè¿™é‡Œçº¦ä¸º 10MB
        "data": {},
        "collection_name": "file-96xxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
        # æ€»ä»¥&apos;file&apos;å¼€å¤´
      },
      "created_at": 1740000000,
      "updated_at": 1740000000
    },
    "id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
    "url": "/api/v1/files/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
    "name": "Napoleon - Wikipedia.pdf",
    "collection_name": "file-96xxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
    "status": "å·²ä¸Šä¼ ï¼ˆuploadedï¼‰",
    "size": 10486578,
    "error": "",
    "itemId": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
    # itemId ä¸ file["id"] ä¸åŒ
  }
]


```

</details>

### `__è¯·æ±‚__`

`fastapi.Request` çš„å®ä¾‹ã€‚ä½ å¯ä»¥åœ¨ [è¿ç§»é¡µé¢](../../features/plugin/migration/index.mdx) æˆ– [fastapi&apos;çš„æ–‡æ¡£](https://fastapi.tiangolo.com/reference/request/) ä¸­é˜…è¯»æ›´å¤šç›¸å…³å†…å®¹ã€‚

### `__ä»»åŠ¡__`

`ä»»åŠ¡ç±»å‹` çš„ `å­—ç¬¦ä¸²`ã€‚å…¶å€¼æ˜¯ `__metadata__["task"]` çš„ç®€å†™ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œå¦åˆ™ä¸º `None`ã€‚

<details>
<summary>å¯èƒ½çš„å€¼</summary>

```json

[
    "æ ‡é¢˜ç”Ÿæˆï¼ˆtitle_generationï¼‰",
    "æ ‡ç­¾ç”Ÿæˆï¼ˆtags_generationï¼‰",
    "è¡¨æƒ…ç”Ÿæˆï¼ˆemoji_generationï¼‰",
    "æŸ¥è¯¢ç”Ÿæˆï¼ˆquery_generationï¼‰",
    "å›¾åƒæç¤ºç”Ÿæˆï¼ˆimage_prompt_generationï¼‰",
    "è‡ªåŠ¨å®Œæˆç”Ÿæˆï¼ˆautocomplete_generationï¼‰",
    "å‡½æ•°è°ƒç”¨ï¼ˆfunction_callingï¼‰",
    "MOAå“åº”ç”Ÿæˆï¼ˆmoa_response_generationï¼‰"
]
```

</details>

### `__ä»»åŠ¡ä½“__`

ä¸€ä¸ªåŒ…å«å®ç°æŒ‡å®šä»»åŠ¡æ‰€éœ€ `body` çš„ `å­—å…¸`ã€‚å…¶å€¼æ˜¯ `__metadata__["task_body"]` çš„ç®€å†™ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œå¦åˆ™ä¸º `None`ã€‚

å…¶ç»“æ„ä¸ä¸Šè¿°çš„ `body` ç›¸åŒï¼Œå¸¦æœ‰ä¿®æ”¹ä»¥ä½¿ç”¨é€‚å½“çš„æ¨¡å‹å’Œç³»ç»Ÿæ¶ˆæ¯ç­‰ã€‚


### `__å·¥å…·__`

`ToolUserModel` å®ä¾‹ç»„æˆçš„ `åˆ—è¡¨`ã€‚

æœ‰å…³ `ToolUserModel` å®ä¾‹å±æ€§çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒ [tools.py](https://github.com/open-webui/open-webui/blob/main/backend/open_webui/models/tools.py) ä¸­çš„ä»£ç ã€‚

