---
sidebar_position: 3
title: "â›‘ï¸ äº‹ä»¶"
---

# â›‘ï¸ äº‹ä»¶ï¼šåœ¨ Open WebUI ä¸­ä½¿ç”¨ `__event_emitter__` å’Œ `__event_call__`

Open WebUI çš„æ’ä»¶æ¶æ§‹ä¸åƒ…åƒ…æ˜¯è™•ç†è¼¸å…¥ä¸¦ç”Ÿæˆè¼¸å‡ºâ€”â€”**å®ƒæ›´æ˜¯èˆ‡ä½¿ç”¨è€…ä»‹é¢å’Œç”¨æˆ¶çš„å³æ™‚äº’å‹•äº¤æµ**ã€‚ç‚ºäº†è®“æ‚¨çš„ Toolsã€Functions å’Œ Pipes æ›´åŠ å‹•æ…‹ï¼ŒOpen WebUI é€šé `__event_emitter__` å’Œ `__event_call__` æä¾›å…§å»ºäº‹ä»¶ç³»çµ±ã€‚

æœ¬æŒ‡å—å°‡è§£é‡‹**ä»€éº¼æ˜¯äº‹ä»¶**ï¼Œ**å¦‚ä½•å¾æ‚¨çš„ä»£ç¢¼è§¸ç™¼å®ƒå€‘**ï¼Œä»¥åŠæ‚¨å¯ä»¥ä½¿ç”¨çš„**äº‹ä»¶é¡å‹å®Œæ•´ç›®éŒ„**ï¼ˆå…§å®¹é è¶…åƒ…åƒ…æ˜¯ `"input"`ï¼‰ã€‚

---

## ğŸŒŠ ä»€éº¼æ˜¯äº‹ä»¶ï¼Ÿ

**äº‹ä»¶**æ˜¯å¾æ‚¨çš„å¾Œç«¯ä»£ç¢¼ï¼ˆTool æˆ– Functionï¼‰ç™¼é€åˆ° Web UI çš„å³æ™‚é€šçŸ¥æˆ–äº’å‹•è«‹æ±‚ã€‚å®ƒå€‘å…è¨±æ‚¨æ›´æ–°èŠå¤©ã€é¡¯ç¤ºé€šçŸ¥ã€è«‹æ±‚ç¢ºèªã€é‹è¡Œ UI æµç¨‹ç­‰ç­‰ã€‚

- äº‹ä»¶ä½¿ç”¨ `__event_emitter__` åŠ©æ‰‹ç™¼é€ä»¥é€²è¡Œå–®å‘æ›´æ–°ï¼Œæˆ–è€…ä½¿ç”¨ `__event_call__` ç•¶æ‚¨éœ€è¦ç”¨æˆ¶è¼¸å…¥æˆ–å›æ‡‰ï¼ˆä¾‹å¦‚ç¢ºèªã€è¼¸å…¥ç­‰ï¼‰ã€‚

**æ¯”å–»ï¼š**
å¯ä»¥æŠŠäº‹ä»¶çœ‹ä½œæ‚¨çš„æ’ä»¶å¯ä»¥è§¸ç™¼çš„æ¨é€é€šçŸ¥å’Œæ¨¡æ…‹å°è©±æ¡†ï¼Œä½¿èŠå¤©é«”é©—æ›´è±å¯Œã€æ›´å…·äº’å‹•æ€§ã€‚

---

## ğŸ§° åŸºæœ¬ç”¨æ³•

### ç™¼é€äº‹ä»¶

æ‚¨å¯ä»¥åœ¨ Tool æˆ– Function çš„ä»»æ„ä½ç½®èª¿ç”¨ä»¥ä¸‹ä»£ç¢¼ä¾†è§¸ç™¼äº‹ä»¶ï¼š

```python
await __event_emitter__(
    {
        "type": "status",  # è«‹åƒè€ƒä¸‹æ–‡ä¸­çš„äº‹ä»¶é¡å‹åˆ—è¡¨
        "data": {
            "description": "è™•ç†é–‹å§‹ï¼",
            "done": False,
            "hidden": False,
        },
    }
)
```

æ‚¨**ä¸éœ€è¦**æ‰‹å‹•æ·»åŠ åƒ `chat_id` æˆ– `message_id` ç­‰å­—æ®µâ€”â€”é€™äº›å°‡ç”± Open WebUI è‡ªå‹•è™•ç†ã€‚

### äº’å‹•äº‹ä»¶

ç•¶æ‚¨éœ€è¦åœ¨ç”¨æˆ¶å›æ‡‰ä¹‹å‰æš«åœåŸ·è¡Œï¼ˆä¾‹å¦‚ç¢ºèª/å–æ¶ˆå°è©±æ¡†ã€ä»£ç¢¼åŸ·è¡Œæˆ–è¼¸å…¥ï¼‰æ™‚ï¼Œè«‹ä½¿ç”¨ `__event_call__`ï¼š

```python
result = await __event_call__(
    {
        "type": "input",  # æˆ–è€… "confirmation", "execute"
        "data": {
            "title": "è«‹è¼¸å…¥æ‚¨çš„å¯†ç¢¼",
            "message": "æ­¤æ“ä½œéœ€è¦å¯†ç¢¼",
            "placeholder": "åœ¨æ­¤è¼¸å…¥æ‚¨çš„å¯†ç¢¼",
        },
    }
)
# result å°‡åŒ…å«ç”¨æˆ¶è¼¸å…¥çš„å€¼
```

---

## ğŸ“œ äº‹ä»¶è¼‰è·çµæ§‹

ç•¶æ‚¨ç™¼å‡ºæˆ–èª¿ç”¨äº‹ä»¶æ™‚ï¼ŒåŸºæœ¬çµæ§‹å¦‚ä¸‹ï¼š

```json
{
  "type": "event_type",   // è«‹åƒè€ƒä¸‹æ–‡å®Œæ•´åˆ—è¡¨
  "data": { ... }         // ç‰¹å®šäº‹ä»¶çš„æ•¸æ“šè¼‰è·
}
```

å¤§å¤šæ•¸æƒ…æ³ä¸‹ï¼Œæ‚¨åªéœ€è¨­ç½® `"type"` å’Œ `"data"`ã€‚Open WebUI å°‡è‡ªå‹•å¡«å……è·¯ç”±ã€‚

---

## ğŸ—‚ äº‹ä»¶é¡å‹å®Œæ•´åˆ—è¡¨

ä»¥ä¸‹æ˜¯ **æ‰€æœ‰æ”¯æ´çš„ `type` å€¼** çš„è©³ç›¡åˆ—è¡¨ï¼ŒåŒ…æ‹¬å…¶é æœŸæ•ˆæœå’Œæ•¸æ“šçµæ§‹ã€‚ï¼ˆåŸºæ–¼å° Open WebUI äº‹ä»¶è™•ç†é‚è¼¯çš„æœ€æ–°åˆ†æã€‚ï¼‰

| type                        | ä½¿ç”¨æƒ…æ™¯                                    | æ•¸æ“šè¼‰è·çµæ§‹ï¼ˆç¤ºä¾‹ï¼‰                                             |
|-----------------------------|-----------------------------------------------|--------------------------------------------------------------------|
| `status`                    | é¡¯ç¤ºæ¶ˆæ¯çš„ç‹€æ…‹æ›´æ–°/æ­·å²                     | `{description: ..., done: bool, hidden: bool}`                     |
| `chat:completion`           | æä¾›èŠå¤©å®Œæˆçµæœ                            | ï¼ˆè‡ªå®šç¾©ï¼Œè«‹åƒè€ƒ Open WebUI çš„å…§éƒ¨æ–‡æª”ï¼‰                          |
| `chat:message:delta`,<br/>`message` | é™„åŠ å…§å®¹åˆ°ç•¶å‰æ¶ˆæ¯                          | `{content: "è¿½åŠ çš„æ–‡å­—"}`                                          |
| `chat:message`,<br/>`replace`        | å®Œå…¨æ›¿æ›ç•¶å‰æ¶ˆæ¯å…§å®¹                          | `{content: "æ›¿æ›çš„æ–‡å­—"}`                                          |
| `chat:message:files`,<br/>`files`   | è¨­ç½®æˆ–è¦†è“‹æ¶ˆæ¯æ–‡ä»¶ï¼ˆç”¨æ–¼ä¸Šå‚³æˆ–è¼¸å‡ºï¼‰          | `{files: [...]}`                                                   |
| `chat:title`                | è¨­ç½®ï¼ˆæˆ–æ›´æ–°ï¼‰èŠå¤©å°è©±ä¸»é¡Œ                  | ä¸»é¡Œå­—ä¸² æˆ– `{title: ...}`                                         |
| `chat:tags`                 | æ›´æ–°èŠå¤©çš„æ¨™ç±¤é›†                            | æ¨™ç±¤æ•¸çµ„æˆ–å°è±¡                                                    |
| `source`,<br/>`citation`              | æ·»åŠ ä¾†æº/å¼•ç”¨ï¼Œæˆ–åŸ·è¡Œä»£ç¢¼çš„çµæœ              | å°æ–¼ä»£ç¢¼ï¼šè«‹åƒè¦‹[ä¸‹æ–‡](#code-execution-event)ã€‚                    |
| `notification`              | åœ¨ UI ä¸­é¡¯ç¤ºé€šçŸ¥ï¼ˆ"toast"ï¼‰                 | `{type: "info" or "success" or "error" or "warning", content: "..."}`      |
| `confirmation` <br/>(éœ€è¦ `__event_call__`) | è«‹æ±‚ç¢ºèªï¼ˆç¢ºå®š/å–æ¶ˆå°è©±æ¡†ï¼‰                  | `{title: "...", message: "..."}`                                   |
| `input` <br/>(éœ€è¦ `__event_call__`)    | è«‹æ±‚ç”¨æˆ¶ç°¡å–®è¼¸å…¥ï¼ˆ"è¼¸å…¥æ¡†"å°è©±æ¡†ï¼‰          | `{title: "...", message: "...", placeholder: "...", value: ...}`   |
| `execute` <br/>(éœ€è¦ `__event_call__`)  | è«‹æ±‚ä½¿ç”¨è€…ç«¯åŸ·è¡Œç¨‹å¼ç¢¼ä¸¦è¿”å›çµæœ  | `{code: "...javascript code..."}`                                  |

**å…¶ä»–/é€²éšé¡å‹ï¼š**

- æ‚¨å¯ä»¥è‡ªå®šç¾©è‡ªå·±çš„é¡å‹ä¸¦åœ¨UIå±¤è™•ç†å®ƒå€‘ï¼ˆæˆ–ä½¿ç”¨å³å°‡æ¨å‡ºçš„äº‹ä»¶æ“´å±•æ©Ÿåˆ¶ï¼‰ã€‚

### â— ç‰¹å®šäº‹ä»¶é¡å‹çš„è©³ç´°è³‡è¨Š
### `status`

åœ¨UIä¸­é¡¯ç¤ºç‹€æ…‹/é€²åº¦æ›´æ–°ï¼š

```python
await __event_emitter__(
    {
        "type": "status",
        "data": {
            "description": "ç¬¬ä¸€æ­¥/å…±ä¸‰æ­¥ï¼šæ­£åœ¨ç²å–è³‡æ–™...",
            "done": False,
            "hidden": False,
        },
    }
)
```

---

### `chat:message:delta` æˆ– `message`

**æµå¼è¼¸å‡º**ï¼ˆè¿½åŠ æ–‡å­—ï¼‰ï¼š

```python
await __event_emitter__(
    {
        "type": "chat:message:delta",  # æˆ–ç°¡å–®åœ°ä½¿ç”¨ "message"
        "data": {
            "content": "éƒ¨åˆ†æ–‡å­—, "
        },
    }
)

# ç¨å¾Œï¼Œéš¨è‘—æ‚¨ç”Ÿæˆæ›´å¤šå…§å®¹ï¼š
await __event_emitter__(
    {
        "type": "chat:message:delta",
        "data": {
            "content": "ä¸‹ä¸€æ®µå›æ‡‰å…§å®¹ã€‚"
        },
    }
)
```

---

### `chat:message` æˆ– `replace`

**è¨­å®šï¼ˆæˆ–å–ä»£ï¼‰æ•´å€‹è¨Šæ¯å…§å®¹ï¼š**

```python
await __event_emitter__(
    {
        "type": "chat:message",  # æˆ– "replace"
        "data": {
            "content": "æœ€çµ‚å®Œæ•´çš„å›æ‡‰å…§å®¹ã€‚"
        },
    }
)
```

---

### `files` æˆ– `chat:message:files`

**é™„åŠ æˆ–æ›´æ–°æ–‡ä»¶ï¼š**

```python
await __event_emitter__(
    {
        "type": "files",  # æˆ– "chat:message:files"
        "data": {
            "files": [
               # Open WebUI æ–‡ä»¶ç‰©ä»¶
            ]
        },
    }
)
```

---

### `chat:title`

**æ›´æ–°èŠå¤©çš„æ¨™é¡Œï¼š**

```python
await __event_emitter__(
    {
        "type": "chat:title",
        "data": {
            "title": "å¸‚å ´åˆ†ææ©Ÿå™¨äººæœƒè©±"
        },
    }
)
```

---

### `chat:tags`

**æ›´æ–°èŠå¤©çš„æ¨™ç±¤ï¼š**

```python
await __event_emitter__(
    {
        "type": "chat:tags",
        "data": {
            "tags": ["é‡‘è", "AI", "æ¯æ—¥å ±å‘Š"]
        },
    }
)
```

---

### `source` æˆ– `citation` ï¼ˆä»¥åŠç¨‹å¼ç¢¼åŸ·è¡Œï¼‰

**æ·»åŠ å¼•ç”¨/æ–‡ç»ï¼š**

```python
await __event_emitter__(
    {
        "type": "source",  # æˆ– "citation"
        "data": {
            # Open WebUI å¼•ç”¨ï¼ˆæ–‡ç»ï¼‰ç‰©ä»¶
        }
    }
)
```

**å°æ–¼ç¨‹å¼ç¢¼åŸ·è¡Œï¼ˆè¿½è¹¤åŸ·è¡Œç‹€æ…‹ï¼‰ï¼š**

```python
await __event_emitter__(
    {
        "type": "source",
        "data": {
            # Open WebUI ç¨‹å¼ç¢¼ä¾†æºï¼ˆå¼•ç”¨ï¼‰ç‰©ä»¶
        }
    }
)
```

---

### `notification`

**é¡¯ç¤ºæç¤ºé€šçŸ¥ï¼š**

```python
await __event_emitter__(
    {
        "type": "notification",
        "data": {
            "type": "info",  # "success", "warning", "error"
            "content": "æ“ä½œå·²æˆåŠŸå®Œæˆï¼"
        }
    }
)
```

---

### `confirmation` (**éœ€è¦** `__event_call__`)

**é¡¯ç¤ºç¢ºèªå°è©±æ¡†ä¸¦ç²å–ä½¿ç”¨è€…å›æ‡‰ï¼š**

```python
result = await __event_call__(
    {
        "type": "confirmation",
        "data": {
            "title": "æ‚¨ç¢ºå®šå—ï¼Ÿ",
            "message": "æ‚¨ç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ"
        }
    }
)

if result:  # æˆ–æª¢æŸ¥çµæœå…§å®¹
    await __event_emitter__({
        "type": "notification",
        "data": {"type": "success", "content": "ä½¿ç”¨è€…å·²ç¢ºèªæ“ä½œã€‚"}
    })
else:
    await __event_emitter__({
        "type": "notification",
        "data": {"type": "warning", "content": "ä½¿ç”¨è€…å–æ¶ˆäº†æ“ä½œã€‚"}
    })
```

---

### `input` (**éœ€è¦** `__event_call__`)

**æç¤ºä½¿ç”¨è€…è¼¸å…¥æ–‡å­—ï¼š**

```python
result = await __event_call__(
    {
        "type": "input",
        "data": {
            "title": "è¼¸å…¥æ‚¨çš„å§“å",
            "message": "æˆ‘å€‘éœ€è¦æ‚¨çš„å§“åä»¥ç¹¼çºŒã€‚",
            "placeholder": "æ‚¨çš„å…¨å"
        }
    }
)

user_input = result
await __event_emitter__(
    {
        "type": "notification",
        "data": {"type": "info", "content": f"æ‚¨è¼¸å…¥çš„æ˜¯ï¼š{user_input}"}
    }
)
```

---

### `execute` (**éœ€è¦** `__event_call__`)

**åœ¨ä½¿ç”¨è€…ç«¯å‹•æ…‹åŸ·è¡Œç¨‹å¼ç¢¼ï¼š**

```python
result = await __event_call__(
    {
        "type": "execute",
        "data": {
            "code": "print(40 + 2);",
        }
    }
)

await __event_emitter__(
    {
        "type": "notification",
        "data": {
            "type": "info",
            "content": f"ç¨‹å¼ç¢¼å·²åŸ·è¡Œï¼Œçµæœï¼š{result}"
        }
    }
)
```

---

## ğŸ—ï¸ ä»€éº¼æ™‚å€™ä»¥åŠåœ¨å“ªè£¡ä½¿ç”¨äº‹ä»¶

- **å¾ä»»ä½•å·¥å…·æˆ–å‡½æ•¸**åœ¨ Open WebUI ä¸­åŸ·è¡Œã€‚
- ç”¨æ–¼**æµå¼å›æ‡‰**ã€é¡¯ç¤ºé€²åº¦ã€è«‹æ±‚ä½¿ç”¨è€…è³‡æ–™ã€æ›´æ–°UIæˆ–é¡¯ç¤ºè£œå……è³‡è¨Š/æ–‡ä»¶ã€‚
- `await __event_emitter__` ç”¨æ–¼å–®å‘æ¶ˆæ¯ï¼ˆåªç™¼é€ä¸ç­‰å¾…å›æ‡‰ï¼‰ã€‚
- `await __event_call__` ç”¨æ–¼éœ€è¦å¾ä½¿ç”¨è€…ç²å¾—å›æ‡‰æ™‚ï¼ˆè¼¸å…¥ã€åŸ·è¡Œã€ç¢ºèªï¼‰ã€‚

---

## ğŸ’¡ æç¤ºèˆ‡é€²éšå‚™è¨»

- **æ¯æ¢è¨Šæ¯çš„å¤šé¡å‹æ”¯æŒï¼š** æ‚¨å¯ä»¥ç‚ºä¸€æ¢æ¶ˆæ¯ç™¼é€ä¸åŒé¡å‹çš„äº‹ä»¶ï¼Œä¾‹å¦‚ï¼šå…ˆé¡¯ç¤º `status` æ›´æ–°ï¼Œå†ä½¿ç”¨ `chat:message:delta` é€²è¡Œæµå¼è¼¸å‡ºï¼Œæœ€å¾Œä½¿ç”¨ `chat:message` å®Œæˆã€‚
- **è‡ªå®šç¾©çš„äº‹ä»¶é¡å‹ï¼š** é›–ç„¶ä¸Šè¿°åˆ—è¡¨æ˜¯æ¨™æº–äº‹ä»¶é¡å‹ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šç¾©çš„é¡å‹ä¸¦åœ¨è‡ªå®šç¾©UIä»£ç¢¼ä¸­æª¢æ¸¬/è™•ç†å®ƒå€‘ã€‚
- **æ“´å±•æ€§:** äº‹ä»¶ç³»çµ±è¨­è¨ˆç‚ºå¯æ¼”åŒ–â€”è«‹éš¨æ™‚æª¢æŸ¥ [Open WebUI æ–‡ä»¶](https://github.com/open-webui/open-webui) ä»¥ç²å–æœ€æ–°çš„åˆ—è¡¨å’Œé«˜ç´šç”¨æ³•ã€‚

---

## ğŸ§ å¸¸è¦‹å•é¡Œ

### å•: æˆ‘å¦‚ä½•è§¸ç™¼é€šçŸ¥çµ¦ä½¿ç”¨è€…ï¼Ÿ
ä½¿ç”¨ `notification` é¡å‹ï¼š
```python
await __event_emitter__({
    "type": "notification",
    "data": {"type": "success", "content": "ä»»å‹™å®Œæˆ"}
})
```

### å•: æˆ‘å¦‚ä½•æç¤ºä½¿ç”¨è€…è¼¸å…¥ä¸¦ç²å¾—ä»–å€‘çš„å›ç­”ï¼Ÿ
ä½¿ç”¨ï¼š
```python
response = await __event_call__({
    "type": "input",
    "data": {
        "title": "ä½ å«ä»€éº¼åå­—ï¼Ÿ",
        "message": "è«‹è¼¸å…¥æ‚¨å–œæ­¡çš„åå­—ï¼š",
        "placeholder": "åå­—"
    }
})
# response å°‡æ˜¯: {"value": "ä½¿ç”¨è€…çš„å›ç­”"}
```

### å•: `__event_call__` æœ‰å“ªäº›å¯ç”¨çš„äº‹ä»¶é¡å‹ï¼Ÿ
- `"input"`: è¼¸å…¥æ¡†å°è©±
- `"confirmation"`: æ˜¯/å¦ã€ç¢ºå®š/å–æ¶ˆå°è©±
- `"execute"`: åœ¨å®¢æˆ¶ç«¯é‹è¡Œæä¾›çš„ä»£ç¢¼ä¸¦è¿”å›çµæœ

### å•: æˆ‘èƒ½æ›´æ–°æ¶ˆæ¯é™„ä»¶çš„æ–‡ä»¶å—ï¼Ÿ
å¯ä»¥â€”ä½¿ç”¨ `"files"` æˆ– `"chat:message:files"` äº‹ä»¶é¡å‹å’Œ `{files: [...]}` è² è¼‰ã€‚

### å•: æˆ‘èƒ½æ›´æ–°æœƒè©±çš„æ¨™é¡Œæˆ–æ¨™ç±¤å—ï¼Ÿ
ç•¶ç„¶å¯ä»¥ï¼šç›¸æ‡‰ä½¿ç”¨ `"chat:title"` æˆ– `"chat:tags"`ã€‚

### å•: æˆ‘èƒ½å°‡æµå¼å›æ‡‰ï¼ˆéƒ¨åˆ† tokensï¼‰å‚³é€çµ¦ä½¿ç”¨è€…å—ï¼Ÿ
å¯ä»¥â€”åœ¨è¿´åœˆä¸­ç™¼å‡º `"chat:message:delta"` äº‹ä»¶ï¼Œç„¶å¾Œä»¥ `"chat:message"` å®Œæˆã€‚

---

## ğŸ“ çµè«–

**äº‹ä»¶**è®“æ‚¨å¯ä»¥åœ¨ Open WebUI ä¸­å¯¦ç¾å³æ™‚äº¤äº’çš„è¶…èƒ½åŠ›ã€‚å®ƒå€‘ä½¿æ‚¨çš„ä»£ç¢¼èƒ½å¤ æ›´æ–°å…§å®¹ã€è§¸ç™¼é€šçŸ¥ã€è«‹æ±‚ä½¿ç”¨è€…è¼¸å…¥ã€å‚³é€æµå¼çµæœã€è™•ç†ä»£ç¢¼ç­‰ç­‰â€”ç„¡ç¸«åœ°å°‡å¾Œç«¯æ™ºæ…§é›†æˆåˆ°èŠå¤©ç•Œé¢ä¸­ã€‚

- ä½¿ç”¨ `__event_emitter__` å¯¦ç¾å–®å‘çš„ç‹€æ…‹/å…§å®¹æ›´æ–°ã€‚
- ä½¿ç”¨ `__event_call__` å¯¦ç¾éœ€è¦ä½¿ç”¨è€…å¾ŒçºŒåé¥‹çš„äº¤äº’ï¼ˆè¼¸å…¥ã€ç¢ºèªã€åŸ·è¡Œï¼‰ã€‚

åƒè€ƒæœ¬æ–‡æª”ä»¥äº†è§£å¸¸è¦‹äº‹ä»¶é¡å‹å’Œçµæ§‹ï¼Œä¸¦æ¢ç´¢ Open WebUI æºä»£ç¢¼æˆ–æ–‡ä»¶ä»¥ç²å–æœ€æ–°æ›´æ–°æˆ–è‡ªå®šç¾©äº‹ä»¶ï¼

---

**ç¥æ‚¨åœ¨ Open WebUI ä¸­æ„‰å¿«åœ°é€²è¡Œäº‹ä»¶é©…å‹•ç·¨ç¨‹ï¼ğŸš€**