---
sidebar_position: 3
title: "‚õëÔ∏è Eventos"
---

# ‚õëÔ∏è Eventos: Uso de `__event_emitter__` y `__event_call__` en Open WebUI

La arquitectura de plugins de Open WebUI no solo se trata de procesar entrada y producir salida‚Äî**se trata de comunicaci√≥n interactiva en tiempo real con la interfaz y los usuarios**. Para hacer que tus Herramientas, Funciones y Pipes sean m√°s din√°micos, Open WebUI proporciona un sistema de eventos incorporado mediante los ayudantes `__event_emitter__` y `__event_call__`.

Esta gu√≠a explica **qu√© son los eventos**, **c√≥mo puedes activarlos** desde tu c√≥digo, y **el cat√°logo completo de tipos de eventos** que puedes usar (incluyendo mucho m√°s que solo `"input"`).

---

## üåä ¬øQu√© son los Eventos?

**Los eventos** son notificaciones en tiempo real o solicitudes interactivas enviadas desde tu c√≥digo backend (Herramienta o Funci√≥n) a la interfaz web. Permiten actualizar el chat, mostrar notificaciones, solicitar confirmaci√≥n, ejecutar flujos de interfaz y m√°s.

- Los eventos se env√≠an utilizando el ayudante `__event_emitter__` para actualizaciones uni-direccionales, o `__event_call__` cuando necesitas entrada o respuesta del usuario (por ejemplo, confirmaci√≥n, entrada, etc.).

**Met√°fora:**  
Piensa en los Eventos como notificaciones push y cuadros de di√°logo modales que tu plugin puede activar, enriqueciendo la experiencia de chat y haci√©ndola m√°s interactiva.

---

## üß∞ Uso B√°sico

### Enviar un Evento

Puedes activar un evento en cualquier lugar dentro de tu Herramienta o Funci√≥n llamando:

```python
await __event_emitter__(
    {
        "type": "status",  # Consulta la lista de tipos de eventos m√°s abajo
        "data": {
            "description": "¬°Procesamiento iniciado!",
            "done": False,
            "hidden": False,
        },
    }
)
```

**No necesitas** a√±adir manualmente campos como `chat_id` o `message_id`‚Äîestos son manejados autom√°ticamente por Open WebUI.

### Eventos Interactivos

Cuando necesites pausar la ejecuci√≥n hasta que el usuario responda (por ejemplo, cuadros de confirmaci√≥n/cancelaci√≥n, ejecuci√≥n de c√≥digo o entrada), usa `__event_call__`:

```python
result = await __event_call__(
    {
        "type": "input",  # O "confirmation", "execute"
        "data": {
            "title": "Por favor ingresa tu contrase√±a",
            "message": "Se requiere la contrase√±a para esta acci√≥n",
            "placeholder": "Tu contrase√±a aqu√≠",
        },
    }
)
# result contendr√° el valor ingresado por el usuario
```

---

## üìú Estructura de Carga √ötil del Evento

Cuando emites o llamas a un evento, la estructura b√°sica es:

```json
{
  "type": "event_type",   // Consulta la lista completa m√°s abajo
  "data": { ... }         // Carga √∫til espec√≠fica del evento
}
```

La mayor√≠a de las veces, solo configuras `"type"` y `"data"`. Open WebUI se encargar√° de completar autom√°ticamente el enrutamiento.

---

## üóÇ Lista Completa de Tipos de Eventos

A continuaci√≥n se presenta una tabla de **todos los valores de `type` soportados** para eventos, junto con su efecto previsto y estructura de carga √∫til de datos. (Esto se basa en un an√°lisis actualizado de la l√≥gica de manejo de eventos de Open WebUI).

| type                        | Cu√°ndo usar                                   | Ejemplos de estructura de carga √∫til de datos                     |
|-----------------------------|-----------------------------------------------|-------------------------------------------------------------------|
| `status`                    | Mostrar una actualizaci√≥n de estado/historial del mensaje  | `{description: ..., done: bool, hidden: bool}`                    |
| `chat:completion`           | Proporcionar un resultado de conclusi√≥n de chat              | (Personalizado, consulta los detalles internos de Open WebUI)      |
| `chat:message:delta`,<br/>`message` | Agregar contenido al mensaje actual              | `{content: "texto para agregar"}`                                 |
| `chat:message`,<br/>`replace`        | Reemplazar completamente el contenido del mensaje          | `{content: "texto de reemplazo"}`                                 |
| `chat:message:files`,<br/>`files`   | Establecer o sobrescribir archivos del mensaje (subidas, salida) | `{files: [...]}`                                                  |
| `chat:title`                | Establecer (o actualizar) el t√≠tulo de la conversaci√≥n de chat   | Cadena de tema O `{title: ...}`                                   |
| `chat:tags`                 | Actualizar el conjunto de etiquetas para un chat             | Array de etiquetas u objeto                                       |
| `source`,<br/>`citation`              | A√±adir una fuente/citaci√≥n o resultado de ejecuci√≥n de c√≥digo     | Para c√≥digo: Consulta [m√°s abajo.](#code-execution-event)          |
| `notification`              | Mostrar una notificaci√≥n ("toast") en la interfaz       | `{type: "info" or "success" or "error" or "warning", content: "..."}`   |
| `confirmation` <br/>(necesita `__event_call__`) | Solicitar confirmaci√≥n (cuadro de di√°logo OK/Cancelar)         | `{title: "...", message: "..."}`                                |
| `input` <br/>(necesita `__event_call__`)    | Solicitar entrada simple del usuario (cuadro de di√°logo "caja de entrada")   | `{title: "...", message: "...", placeholder: "...", value: ...}`
| `execute` <br/>(requiere `__event_call__`)  | Solicitar ejecuci√≥n de c√≥digo del lado del usuario y devolver el resultado  | `{code: "...c√≥digo javascript..."}`                                  |

**Otros tipos/avanzados:**

- Puedes definir tus propios tipos y manejarlos en la capa de la interfaz de usuario (o usar los pr√≥ximos mecanismos de extensi√≥n de eventos).

### ‚ùó Detalles sobre tipos de eventos espec√≠ficos
### `status`

Mostrar un estado/avance en la interfaz de usuario:

```python
await __event_emitter__(
    {
        "type": "status",
        "data": {
            "description": "Paso 1/3: Obteniendo datos...",
            "done": False,
            "hidden": False,
        },
    }
)
```

---

### `chat:message:delta` o `message`

**Salida en streaming** (a√±adir texto):

```python
await __event_emitter__(
    {
        "type": "chat:message:delta",  # o simplemente "message"
        "data": {
            "content": "Texto parcial, "
        },
    }
)

# M√°s tarde, a medida que generes m√°s:
await __event_emitter__(
    {
        "type": "chat:message:delta",
        "data": {
            "content": "siguiente fragmento de la respuesta."
        },
    }
)
```

---

### `chat:message` o `replace`

**Establecer (o reemplazar) todo el contenido del mensaje:**

```python
await __event_emitter__(
    {
        "type": "chat:message",  # o "replace"
        "data": {
            "content": "Respuesta final, completa."
        },
    }
)
```

---

### `files` o `chat:message:files`

**Adjuntar o actualizar archivos:**

```python
await __event_emitter__(
    {
        "type": "files",  # o "chat:message:files"
        "data": {
            "files": [
               # Objetos de archivo de Open WebUI
            ]
        },
    }
)
```

---

### `chat:title`

**Actualizar el t√≠tulo del chat:**

```python
await __event_emitter__(
    {
        "type": "chat:title",
        "data": {
            "title": "Sesi√≥n del Bot de An√°lisis de Mercado"
        },
    }
)
```

---

### `chat:tags`

**Actualizar las etiquetas del chat:**

```python
await __event_emitter__(
    {
        "type": "chat:tags",
        "data": {
            "tags": ["finanzas", "IA", "reporte-diario"]
        },
    }
)
```

---

### `source` o `citation` (y ejecuci√≥n de c√≥digo)

**A√±adir una referencia o cita:**

```python
await __event_emitter__(
    {
        "type": "source",  # o "citation"
        "data": {
            # Objeto de Fuente (Citaci√≥n) de Open WebUI
        }
    }
)
```

**Para ejecuci√≥n de c√≥digo (seguimiento del estado de ejecuci√≥n):**

```python
await __event_emitter__(
    {
        "type": "source",
        "data": {
            # Objeto de Fuente de C√≥digo de Open WebUI
        }
    }
)
```

---

### `notification`

**Mostrar una notificaci√≥n emergente:**

```python
await __event_emitter__(
    {
        "type": "notification",
        "data": {
            "type": "info",  # "success", "warning", "error"
            "content": "¬°La operaci√≥n se complet√≥ con √©xito!"
        }
    }
)
```

---

### `confirmation` (**requiere** `__event_call__`)

**Mostrar un di√°logo de confirmaci√≥n y obtener la respuesta del usuario:**

```python
result = await __event_call__(
    {
        "type": "confirmation",
        "data": {
            "title": "¬øEst√°s seguro?",
            "message": "¬øRealmente deseas continuar?"
        }
    }
)

if result:  # o verifica el contenido del resultado
    await __event_emitter__({
        "type": "notification",
        "data": {"type": "success", "content": "El usuario confirm√≥ la operaci√≥n."}
    })
else:
    await __event_emitter__({
        "type": "notification",
        "data": {"type": "warning", "content": "El usuario cancel√≥."}
    })
```

---

### `input` (**requiere** `__event_call__`)

**Solicitar al usuario entrada de texto:**

```python
result = await __event_call__(
    {
        "type": "input",
        "data": {
            "title": "Introduce tu nombre",
            "message": "Necesitamos tu nombre para continuar.",
            "placeholder": "Tu nombre completo"
        }
    }
)

user_input = result
await __event_emitter__(
    {
        "type": "notification",
        "data": {"type": "info", "content": f"Ingresaste: {user_input}"}
    }
)
```

---

### `execute` (**requiere** `__event_call__`)

**Ejecutar c√≥digo din√°micamente en el lado del usuario:**

```python
result = await __event_call__(
    {
        "type": "execute",
        "data": {
            "code": "print(40 + 2);",
        }
    }
)

await __event_emitter__(
    {
        "type": "notification",
        "data": {
            "type": "info",
            "content": f"C√≥digo ejecutado, resultado: {result}"
        }
    }
)
```

---

## üèóÔ∏è Cu√°ndo y d√≥nde usar eventos

- **Desde cualquier Herramienta o Funci√≥n** en Open WebUI.
- Para **transmitir respuestas**, mostrar progreso, solicitar datos de usuario, actualizar la interfaz de usuario o mostrar informaci√≥n/archivos complementarios.
- `await __event_emitter__` es para mensajes unidireccionales (disparar y olvidar).
- `await __event_call__` es para cuando necesitas una respuesta del usuario (entrada, ejecuci√≥n, confirmaci√≥n).

---

## üí° Consejos y notas avanzadas

- **Varios tipos por mensaje:** Puedes emitir varios eventos de diferentes tipos para un mensaje, por ejemplo, mostrar actualizaciones de `status`, luego transmitir con `chat:message:delta` y finalmente completar con un `chat:message`.
- **Tipos de eventos personalizados:** Aunque la lista anterior es el est√°ndar, puedes usar tus propios tipos y detectarlos/controlarlos en un c√≥digo de interfaz de usuario personalizado.
- **Extensibilidad:** El sistema de eventos est√° dise√±ado para evolucionar. Consulta siempre la [documentaci√≥n de Open WebUI](https://github.com/open-webui/open-webui) para la lista m√°s actual y su uso avanzado.

---

## üßê Preguntas frecuentes

### P: ¬øC√≥mo se activa una notificaci√≥n para el usuario?
Usa el tipo `notification`:
```python
await __event_emitter__({
    "type": "notification",
    "data": {"type": "success", "content": "Tarea completada"}
})
```

### P: ¬øC√≥mo solicito al usuario una entrada y obtengo su respuesta?
Usa:
```python
response = await __event_call__({
    "type": "input",
    "data": {
        "title": "¬øCu√°l es tu nombre?",
        "message": "Por favor introduce tu nombre preferido:",
        "placeholder": "Nombre"
    }
})
# la respuesta ser√°: {"value": "respuesta del usuario"}
```

### P: ¬øQu√© tipos de eventos est√°n disponibles para `__event_call__`?
- `"input"`: Cuadro de di√°logo para entrada
- `"confirmation"`: Di√°logo de S√≠/No, OK/Cancelar
- `"execute"`: Ejecutar c√≥digo proporcionado en el cliente y devolver el resultado

### P: ¬øPuedo actualizar archivos adjuntos a un mensaje?
S√≠, usa el tipo de evento `"files"` o `"chat:message:files"` con un payload `{files: [...]}`.

### P: ¬øPuedo actualizar el t√≠tulo o las etiquetas de la conversaci√≥n?
Por supuesto: usa `"chat:title"` o `"chat:tags"` seg√∫n corresponda.

### P: ¬øPuedo transmitir respuestas (tokens parciales) al usuario?
S√≠, emite eventos `"chat:message:delta"` en un bucle y luego finaliza con `"chat:message"`.

---

## üìù Conclusi√≥n

**Los eventos** te dan superpoderes interactivos en tiempo real dentro de Open WebUI. Permiten que tu c√≥digo actualice contenido, genere notificaciones, solicite entrada del usuario, transmita resultados, maneje c√≥digo y mucho m√°s, integrando sin problemas tu inteligencia de backend en la interfaz de chat.

- Usa `__event_emitter__` para actualizaciones de estado/contenido unidireccionales.
- Usa `__event_call__` para interacciones que requieren seguimiento del usuario (entrada, confirmaci√≥n, ejecuci√≥n).

Consulta este documento para tipos de eventos y estructuras comunes, y explora el c√≥digo fuente o la documentaci√≥n de Open WebUI para actualizaciones importantes o eventos personalizados.

---

**¬°Feliz programaci√≥n basada en eventos en Open WebUI! üöÄ**