---
sidebar_position: 2
title: "üõ†Ô∏è D√©veloppement"
---



## √âcrire un Toolkit Personnalis√©

Les toolkits sont d√©finis dans un seul fichier Python, avec une docstring de niveau sup√©rieur contenant des m√©tadonn√©es et une classe `Tools`.

### Exemple de Docstring de Niveau Sup√©rieur

```python
"""
title: Inversion de cha√Æne
author: Votre Nom
author_url: https://website.com
git_url: https://github.com/username/string-reverse.git
description: Cet outil calcule l'inverse d'une cha√Æne
required_open_webui_version: 0.4.0
requirements: langchain-openai, langgraph, ollama, langchain_ollama
version: 0.4.0
licence: MIT
"""
```

### Classe Tools

Les outils doivent √™tre d√©finis comme des m√©thodes au sein d'une classe appel√©e `Tools`, avec des sous-classes optionnelles appel√©es `Valves` et `UserValves`, par exemple :

```python
class Tools:
    def __init__(self):
        """Initialiser l'outil."""
        self.valves = self.Valves()

    class Valves(BaseModel):
        api_key: str = Field("", description="Votre cl√© API ici")

    def reverse_string(self, string: str) -> str:
        """
        Inverse la cha√Æne d'entr√©e.
        :param string: La cha√Æne √† inverser
        """
        # Exemple d'utilisation des valves
        if self.valves.api_key != "42":
            return "Cl√© API incorrecte"
        return string[::-1] 
```

### Indications de Type
Chaque outil doit inclure des indications de type pour les arguments. Les types peuvent √©galement √™tre imbriqu√©s, comme `queries_and_docs: list[tuple[str, int]]`. Ces indications de type sont utilis√©es pour g√©n√©rer le sch√©ma JSON qui est envoy√© au mod√®le. Les outils sans indications de type fonctionneront avec beaucoup moins de coh√©rence.

### Valves et UserValves - (optionnel, mais FORTEMENT recommand√©)

Les Valves et UserValves sont utilis√©es pour sp√©cifier les param√®tres personnalisables de l'outil. Vous pouvez en lire davantage sur la page d√©di√©e [Valves & UserValves](../valves/index.mdx).

### Arguments Optionnels
Voici une liste d'arguments optionnels dont vos outils peuvent d√©pendre :
- `__event_emitter__`: √âmettre des √©v√©nements (voir la section suivante)
- `__event_call__`: Identique √† l'√©metteur d'√©v√©nements mais peut √™tre utilis√© pour les interactions utilisateur
- `__user__`: Un dictionnaire avec des informations utilisateur. Il contient √©galement l'objet `UserValves` dans `__user__["valves"]`.
- `__metadata__`: Dictionnaire avec des m√©tadonn√©es de chat
- `__messages__`: Liste des messages pr√©c√©dents
- `__files__`: Fichiers joints
- `__model__`: Un dictionnaire avec des informations sur le mod√®le

Ajoutez simplement ces √©l√©ments comme argument √† n'importe quelle m√©thode de votre classe Tool, comme `__user__` dans l'exemple ci-dessus.

### √âmetteurs d'√âv√©nements
Les √©metteurs d'√©v√©nements sont utilis√©s pour ajouter des informations suppl√©mentaires √† l'interface de chat. De mani√®re similaire aux Filter Outlets, les √©metteurs d'√©v√©nements sont capables d'ajouter du contenu au chat. Contrairement aux Filter Outlets, ils ne peuvent pas supprimer d'informations. De plus, les √©metteurs peuvent √™tre activ√©s √† n'importe quelle √©tape pendant l'utilisation de l'outil.

Il existe deux types diff√©rents d'√©metteurs d'√©v√©nements :

Si le mod√®le semble incapable d'appeler l'outil, assurez-vous qu'il est activ√© (soit via la page Mod√®le ou via le signe `+` √† c√¥t√© du champ d'entr√©e du chat). Vous pouvez √©galement passer l'argument `Function Calling` de la section `Advanced Params` de la page Mod√®le de `Default` √† `Native`.

#### Statut
Cela est utilis√© pour ajouter des statuts √† un message pendant qu'il effectue des √©tapes. Ceux-ci peuvent √™tre effectu√©s √† n'importe quelle √©tape pendant l'utilisation de l'outil. Ces statuts apparaissent juste au-dessus du contenu du message. Ils sont tr√®s utiles pour les outils qui retardent la r√©ponse du LLM ou traitent de grandes quantit√©s d'informations. Cela permet d'informer les utilisateurs de ce qui est en cours de traitement en temps r√©el.

```python
await __event_emitter__(
            {
                "type": "status", # On d√©finit le type ici
                "data": {"description": "Message affich√© dans le chat", "done": False, "hidden": False}, 
                # Notez que done est False ici, ce qui indique que nous continuons d'√©mettre des statuts
            }
        )
```

<details>
<summary>Exemple</summary>

```python
async def test_function(
        self, prompt: str, __user__: dict, __event_emitter__=None
    ) -> str:
        """
        Ceci est une d√©monstration

        :param test: ceci est un param√®tre de test
        """

        await __event_emitter__(
            {
                "type": "status", # Nous d√©finissons le type ici
                "data": {"description": "Message affich√© dans le chat", "done": False}, 
                # Notez que done est False ici, ce qui indique que nous continuons d'√©mettre des statuts
            }
        )

        # Effectuez quelques autres logiques ici
        await __event_emitter__(
            {
                "type": "status",
                "data": {"description": "Message de t√¢che termin√©e", "done": True, "hidden": False},
                # Notez que done est True ici, ce qui indique que nous avons termin√© d'√©mettre des statuts
                # Vous pouvez √©galement d√©finir "hidden": True si vous souhaitez supprimer le statut une fois le message retourn√©
            }
        )

        except Exception as e:
            await __event_emitter__(
                {
                    "type": "status",
                    "data": {"description": f"Une erreur s'est produite : {e}", "done": True},
                }
            )

            return f"Dites √† l'utilisateur : {e}"
```
</details>

#### Message
Ce type est utilis√© pour ajouter un message au LLM √† tout moment dans l'outil. Cela signifie que vous pouvez ajouter des messages, int√©grer des images et m√™me afficher des pages Web avant, apr√®s ou pendant la r√©ponse du LLM.

```python
await __event_emitter__(
                    {
                        "type": "message", # Nous d√©finissons le type ici
                        "data": {"content": "Ce message sera ajout√© au chat."},
                        # Notez qu'avec les types de messages, nous n'avons PAS besoin de d√©finir une condition 'done'
                    }
                )
```

<details>
<summary>Exemple</summary>

```python
async def test_function(
        self, prompt: str, __user__: dict, __event_emitter__=None
    ) -> str:
        """
        Ceci est une d√©monstration

        :param test: ceci est un param√®tre de test
        """

        await __event_emitter__(
                    {
                        "type": "message", # Nous d√©finissons le type ici
                        "data": {"content": "Ce message sera ajout√© au chat."},
                        # Notez qu'avec les types de messages, nous n'avons PAS besoin de d√©finir une condition 'done'
                    }
                )

        except Exception as e:
            await __event_emitter__(
                {
                    "type": "status",
                    "data": {"description": f"Une erreur est survenue : {e}", "done": True},
                }
            )

            return f"Dites √† l'utilisateur : {e}"
```
</details>

#### Citations
Ce type est utilis√© pour fournir des citations ou des r√©f√©rences dans le chat. Vous pouvez l'utiliser pour sp√©cifier le contenu, la source et les m√©tadonn√©es pertinentes. Voici un exemple de comment √©mettre un √©v√©nement de citation :

```python
await __event_emitter__(
    {
        "type": "citation",
        "data": {
            "document": [content],
            "metadata": [
                {
                    "date_accessed": datetime.now().isoformat(),
                    "source": title,
                }
            ],
            "source": {"name": title, "url": url},
        },
    }
)
```
Si vous envoyez plusieurs citations, vous pouvez parcourir les citations et appeler plusieurs fois l'√©metteur. Lors de l'impl√©mentation de citations personnalis√©es, veillez √† d√©finir `self.citation = False` dans la m√©thode `__init__` de votre classe `Tools`. Sinon, les citations int√©gr√©es remplaceront celles que vous avez envoy√©es. Par exemple :

```python
def __init__(self):
    self.citation = False
```

Attention : si vous d√©finissez `self.citation = True`, cela remplacera toutes les citations personnalis√©es que vous envoyez par la citation de retour g√©n√©r√©e automatiquement. En la d√©sactivant, vous pouvez g√©rer enti√®rement vos propres r√©f√©rences de citation.

<details>
<summary>Exemple</summary>

```python
class Tools:
    class UserValves(BaseModel):
        test: bool = Field(
            default=True, description="test"
        )

    def __init__(self):
        self.citation = False

async def test_function(
        self, prompt: str, __user__: dict, __event_emitter__=None
    ) -> str:
        """
        Ceci est une d√©monstration qui ne fait que cr√©er une citation

        :param test: ceci est un param√®tre de test
        """

        await __event_emitter__(
            {
                "type": "citation",
                "data": {
                    "document": ["Ce message sera ajout√© au chat comme une citation lorsqu'on clique dessus"],
                    "metadata": [
                        {
                            "date_accessed": datetime.now().isoformat(),
                            "source": title,
                        }
                    ],
                    "source": {"name": "Titre du contenu", "url": "http://link-to-citation"},
                },
            }
        )
```
</details>

## Packages externes

Dans les m√©tadonn√©es de d√©finition d'outil, vous pouvez sp√©cifier des packages personnalis√©s. Lorsque vous cliquez sur `Enregistrer`, la ligne sera analys√©e et `pip install` sera ex√©cut√© sur toutes les exigences en une fois.

Gardez √† l'esprit qu'√©tant donn√© que pip est utilis√© dans le m√™me processus qu'Open WebUI, l'interface utilisateur sera compl√®tement non r√©active pendant l'installation.

Aucune mesure n'est prise pour g√©rer les conflits de packages avec les exigences d'Open WebUI. Cela signifie que sp√©cifier des exigences peut casser Open WebUI si vous n'√™tes pas prudent. Vous pourriez √™tre en mesure de contourner cela en sp√©cifiant `open-webui` lui-m√™me comme une exigence.


<details>
<summary>Exemple</summary>

```python
"""
title: myToolName
author: myName
funding_url: [tout lien ici sera affich√© derri√®re un bouton `C≈ìur` pour permettre aux utilisateurs de vous soutenir]
version: 1.0.0
# la version est affich√©e dans l'interface utilisateur pour aider les utilisateurs √† suivre les mises √† jour.
license: GPLv3
description: [recommand√©]
requirements: package1>=2.7.0,package2,package3
"""
```

</details>
