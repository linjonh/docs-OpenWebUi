---
sidebar_position: 3
title: "‚õëÔ∏è √âv√©nements"
---

# ‚õëÔ∏è √âv√©nements : Utilisation de `__event_emitter__` et `__event_call__` dans Open WebUI

L'architecture des plugins d'Open WebUI ne se limite pas √† traiter des entr√©es et produire des sorties‚Äî**elle concerne la communication interactive en temps r√©el avec l'interface utilisateur et les utilisateurs**. Pour rendre vos outils, fonctions et pipelines plus dynamiques, Open WebUI fournit un syst√®me d'√©v√©nements int√©gr√© via les aides `__event_emitter__` et `__event_call__`.

Ce guide explique **ce que sont les √©v√©nements**, **comment vous pouvez les d√©clencher** depuis votre code, et **le catalogue complet des types d'√©v√©nements** que vous pouvez utiliser (y compris bien plus que juste `"input"`).

---

## üåä Que sont les √âv√©nements ?

**Les √âv√©nements** sont des notifications en temps r√©el ou des demandes interactives envoy√©es depuis votre code backend (outil ou fonction) vers l'interface web. Ils vous permettent de mettre √† jour le chat, d'afficher des notifications, de demander une confirmation, de lancer des processus UI, et bien plus.

- Les √©v√©nements sont envoy√©s en utilisant l'aide `__event_emitter__` pour des mises √† jour unidirectionnelles, ou `__event_call__` lorsque vous avez besoin de l'entr√©e ou de la r√©ponse utilisateur (par exemple, confirmation, entr√©e, etc.).

**M√©taphore :**
Pensez aux √©v√©nements comme des notifications push et des bo√Ætes de dialogue modales que votre plugin peut d√©clencher, rendant l'exp√©rience de chat plus riche et interactive.

---

## üß∞ Utilisation de Base

### Envoyer un √âv√©nement

Vous pouvez d√©clencher un √©v√©nement n'importe o√π dans votre outil ou fonction en appelant :

```python
await __event_emitter__(
    {
        "type": "status",  # Voir la liste des types d'√©v√©nements ci-dessous
        "data": {
            "description": "Traitement commenc√© !",
            "done": False,
            "hidden": False,
        },
    }
)
```

Vous **n'avez pas besoin** d'ajouter manuellement des champs comme `chat_id` ou `message_id`‚Äîceux-ci sont automatiquement g√©r√©s par Open WebUI.

### √âv√©nements Interactifs

Lorsque vous devez suspendre l'ex√©cution jusqu'√† ce que l'utilisateur r√©ponde (par exemple, dialogues de confirmation/annulation, ex√©cution de code ou entr√©e), utilisez `__event_call__` :

```python
result = await __event_call__(
    {
        "type": "input",  # Ou "confirmation", "execute"
        "data": {
            "title": "Veuillez entrer votre mot de passe",
            "message": "Un mot de passe est requis pour cette action",
            "placeholder": "Votre mot de passe ici",
        },
    }
)
# result contiendra la valeur saisie par l'utilisateur
```

---

## üìú Structure des Donn√©es des √âv√©nements

Lorsque vous √©mettez ou appelez un √©v√©nement, la structure de base est :

```json
{
  "type": "event_type",   // Voir liste compl√®te ci-dessous
  "data": { ... }         // Charges utiles sp√©cifiques √† l'√©v√©nement
}
```

La plupart du temps, vous ne d√©finissez que `"type"` et `"data"`. Open WebUI remplit automatiquement le routage.

---

## üóÇ Liste Compl√®te des Types d'√âv√©nements

Ci-dessous figure une table compl√®te de **toutes les valeurs `type` prises en charge** pour les √©v√©nements, avec leur effet pr√©vu et leur structure de donn√©es. (Bas√© sur une analyse √† jour de la logique de gestion des √©v√©nements dans Open WebUI.)

| type                        | Quand l'utiliser                              | Structure des charges utiles de donn√©es (exemples)                 |
|-----------------------------|-----------------------------------------------|--------------------------------------------------------------------|
| `status`                    | Afficher une mise √† jour de statut/historique pour un message | `{description: ..., done: bool, hidden: bool}`                     |
| `chat:completion`           | Fournir un r√©sultat de compl√©tion de discussion | (Personnalis√©, voir les internes d'Open WebUI)                      |
| `chat:message:delta`,<br/>`message` | Ajouter du contenu au message actuel               | `{content: "texte √† ajouter"}`                                     |
| `chat:message`,<br/>`replace`        | Remplacer compl√®tement le contenu du message actuel      | `{content: "texte de remplacement"}`                               |
| `chat:message:files`,<br/>`files`   | D√©finir ou remplacer les fichiers de message (pour les t√©l√©chargements, le rendu) | `{files: [...]}`                                                   |
| `chat:title`                | D√©finir (ou mettre √† jour) le titre de la conversation de chat | Cha√Æne de sujet OU `{title: ...}`                                   |
| `chat:tags`                 | Mettre √† jour l'ensemble des tags pour un chat              | Tableau de tags ou objet                                            |
| `source`,<br/>`citation`              | Ajouter une source/citation, ou un r√©sultat d'ex√©cution de code         | Pour le code : voir [ci-dessous.](#code-execution-event)            |
| `notification`              | Afficher une notification ("toast") dans l'interface utilisateur | `{type: "info" ou "success" ou "error" ou "warning", content: "..."}`      |
| `confirmation` <br/>(requiert `__event_call__`) | Demander une confirmation (dialogue OK/Annuler)             | `{title: "...", message: "..."}`                                   |
| `input` <br/>(requiert `__event_call__`)    | Demander une simple entr√©e utilisateur (bo√Æte de dialogue "input box")      | `{title: "...", message: "...", placeholder: "...", value: ...}`   |
| `ex√©cuter` <br/>(n√©cessite `__event_call__`)  | Demander l'ex√©cution de code c√¥t√© utilisateur et retourner le r√©sultat  | `{code: "...code javascript..."}` |

**Autres types/Avanc√©s :**

- Vous pouvez d√©finir vos propres types et les g√©rer au niveau de l'interface utilisateur (ou utiliser les m√©canismes d'extension √©v√©nementiels √† venir).

### ‚ùó D√©tails sur les types d'√©v√©nements sp√©cifiques
### `status`

Afficher une mise √† jour de statut/avancement dans l'interface utilisateur¬†:

```python
await __event_emitter__(
    {
        "type": "status",
        "data": {
            "description": "√âtape 1/3¬†: R√©cup√©ration des donn√©es...",
            "done": False,
            "hidden": False,
        },
    }
)
```

---

### `chat:message:delta` ou `message`

**Sortie en flux** (ajouter du texte)¬†:

```python
await __event_emitter__(
    {
        "type": "chat:message:delta",  # ou simplement "message"
        "data": {
            "content": "Texte partiel, "
        },
    }
)

# Plus tard, au fur et √† mesure que vous g√©n√©rez davantage¬†:
await __event_emitter__(
    {
        "type": "chat:message:delta",
        "data": {
            "content": "prochaine partie de la r√©ponse."
        },
    }
)
```

---

### `chat:message` ou `replace`

**D√©finir (ou remplacer) le contenu entier du message¬†:**

```python
await __event_emitter__(
    {
        "type": "chat:message",  # ou "replace"
        "data": {
            "content": "R√©ponse finale et compl√®te."
        },
    }
)
```

---

### `files` ou `chat:message:files`

**Joindre ou mettre √† jour des fichiers¬†:**

```python
await __event_emitter__(
    {
        "type": "files",  # ou "chat:message:files"
        "data": {
            "files": [
               # Objets de fichiers Open WebUI
            ]
        },
    }
)
```

---

### `chat:title`

**Mettre √† jour le titre du chat¬†:**

```python
await __event_emitter__(
    {
        "type": "chat:title",
        "data": {
            "title": "Session de bot d'analyse de march√©"
        },
    }
)
```

---

### `chat:tags`

**Mettre √† jour les tags du chat¬†:**

```python
await __event_emitter__(
    {
        "type": "chat:tags",
        "data": {
            "tags": ["finance", "IA", "rapport quotidien"]
        },
    }
)
```

---

### `source` ou `citation` (et ex√©cution de code)

**Ajouter une r√©f√©rence/citation¬†:**

```python
await __event_emitter__(
    {
        "type": "source",  # ou "citation"
        "data": {
            # Objet Source (Citation) Open WebUI
        }
    }
)
```

**Pour l'ex√©cution de code (suivre l'√©tat d'ex√©cution)¬†:**

```python
await __event_emitter__(
    {
        "type": "source",
        "data": {
            # Objet Source de Code Open WebUI
        }
    }
)
```

---

### `notification`

**Afficher une notification toast¬†:**

```python
await __event_emitter__(
    {
        "type": "notification",
        "data": {
            "type": "info",  # "success", "warning", "error"
            "content": "L'op√©ration s'est termin√©e avec succ√®s !"
        }
    }
)
```

---

### `confirmation` (**n√©cessite** `__event_call__`)

**Afficher une bo√Æte de dialogue de confirmation et obtenir la r√©ponse de l'utilisateur¬†:**

```python
result = await __event_call__(
    {
        "type": "confirmation",
        "data": {
            "title": "√ätes-vous s√ªr¬†?",
            "message": "Voulez-vous vraiment continuer¬†?"
        }
    }
)

if result:  # ou v√©rifier le contenu du r√©sultat
    await __event_emitter__({
        "type": "notification",
        "data": {"type": "success", "content": "L'utilisateur a confirm√© l'op√©ration."}
    })
else:
    await __event_emitter__({
        "type": "notification",
        "data": {"type": "warning", "content": "L'utilisateur a annul√©."}
    })
```

---

### `input` (**n√©cessite** `__event_call__`)

**Demander √† l'utilisateur une saisie de texte¬†:**

```python
result = await __event_call__(
    {
        "type": "input",
        "data": {
            "title": "Entrez votre nom",
            "message": "Nous avons besoin de votre nom pour continuer.",
            "placeholder": "Votre nom complet"
        }
    }
)

user_input = result
await __event_emitter__(
    {
        "type": "notification",
        "data": {"type": "info", "content": f"Vous avez entr√©¬†: {user_input}"}
    }
)
```

---

### `ex√©cuter` (**n√©cessite** `__event_call__`)

**Ex√©cuter du code dynamiquement c√¥t√© utilisateur¬†:**

```python
result = await __event_call__(
    {
        "type": "execute",
        "data": {
            "code": "print(40 + 2);",
        }
    }
)

await __event_emitter__(
    {
        "type": "notification",
        "data": {
            "type": "info",
            "content": f"Code ex√©cut√©, r√©sultat¬†: {result}"
        }
    }
)
```

---

## üèóÔ∏è Quand & O√π utiliser les √©v√©nements

- **√Ä partir de n'importe quel outil ou fonction** dans Open WebUI.
- Pour **diffuser des r√©ponses**, afficher une progression, demander des donn√©es utilisateur, mettre √† jour l'interface utilisateur ou afficher des informations/fichiers suppl√©mentaires.
- `await __event_emitter__` est pour les messages unidirectionnels (√©mission et oubli).
- `await __event_call__` est pour lorsque vous avez besoin d'une r√©ponse de l'utilisateur (saisie, ex√©cution, confirmation).

---

## üí° Conseils & Notes Avanc√©es

- **Types multiples par message¬†:** Vous pouvez √©mettre plusieurs √©v√©nements de types diff√©rents pour un seul message¬†‚Äî par exemple, afficher des mises √† jour `status`, puis diffuser avec `chat:message:delta`, puis terminer avec un `chat:message`.
- **Types d'√©v√©nements personnalis√©s¬†:** Bien que la liste ci-dessus soit la norme, vous pouvez utiliser vos propres types et les d√©tecter/g√©rer dans du code UI personnalis√©.
- **Extensibilit√© :** Le syst√®me d'√©v√©nements est con√ßu pour √©voluer‚Äîconsultez toujours la [documentation Open WebUI](https://github.com/open-webui/open-webui) pour la liste la plus r√©cente et une utilisation avanc√©e.

---

## üßê FAQ

### Q : Comment d√©clencher une notification pour l'utilisateur ?
Utilisez le type `notification` :
```python
await __event_emitter__({
    "type": "notification",
    "data": {"type": "success", "content": "T√¢che termin√©e"}
})
```

### Q : Comment demander une entr√©e √† l'utilisateur et obtenir sa r√©ponse ?
Utilisez :
```python
response = await __event_call__({
    "type": "input",
    "data": {
        "title": "Quel est votre nom ?",
        "message": "Veuillez entrer votre nom pr√©f√©r√© :",
        "placeholder": "Nom"
    }
})
# la r√©ponse sera : {"value": "r√©ponse de l'utilisateur"}
```

### Q : Quels types d'√©v√©nements sont disponibles pour `__event_call__` ?
- `"input"` : Bo√Æte de dialogue d'entr√©e
- `"confirmation"` : Dialogue Oui/Non, OK/Annuler
- `"execute"` : Ex√©cutez le code fourni sur le client et retournez le r√©sultat

### Q : Puis-je mettre √† jour les fichiers joints √† un message ?
Oui‚Äîutilisez le type d'√©v√©nement `"files"` ou `"chat:message:files"` avec une charge utile `{files: [...]}`.

### Q : Puis-je mettre √† jour le titre ou les tags de la conversation ?
Absolument : utilisez `"chat:title"` ou `"chat:tags"` en cons√©quence.

### Q : Puis-je transmettre des r√©ponses (tokens partiels) √† l'utilisateur ?
Oui‚Äî√©mettez des √©v√©nements `"chat:message:delta"` en boucle, puis terminez avec `"chat:message"`.

---

## üìù Conclusion

**Les √©v√©nements** vous donnent des super-pouvoirs interactifs en temps r√©el dans Open WebUI. Ils permettent √† votre code de mettre √† jour du contenu, d√©clencher des notifications, demander des entr√©es utilisateur, diffuser des r√©sultats, g√©rer le code et bien plus encore‚Äîint√©grant harmonieusement votre intelligence backend dans l'interface utilisateur de chat.

- Utilisez `__event_emitter__` pour des mises √† jour de statut/contenu unidirectionnelles.
- Utilisez `__event_call__` pour des interactions n√©cessitant un suivi utilisateur (entr√©e, confirmation, ex√©cution).

R√©f√©rez-vous √† ce document pour les types d'√©v√©nements et structures courants, et explorez le code source ou les docs Open WebUI pour des mises √† jour majeures ou des √©v√©nements personnalis√©s !

---

**Bon codage √©v√©nementiel dans Open WebUI ! üöÄ**