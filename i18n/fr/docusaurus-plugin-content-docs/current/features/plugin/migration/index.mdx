---
sidebar_position: 4
title: "ğŸšš Migration des outils et fonctions : 0.4 vers 0.5"
---

# ğŸšš Guide de Migration : Open WebUI 0.4 vers 0.5

Bienvenue dans le guide de migration d'Open WebUI 0.5 ! Que vous travailliez sur des projets existants ou en construisiez de nouveaux, ce guide vous expliquera les principaux changements entre les versions **0.4 et 0.5** et vous fournira une feuille de route facile Ã  suivre pour mettre Ã  jour vos fonctions. Rendons cette transition aussi fluide que possible ! ğŸ˜Š

---

## ğŸ§ Qu'est-ce qui a changÃ© et pourquoi ?

Avec Open WebUI 0.5, nous avons repensÃ© l'architecture pour rendre le projet **plus simple, plus unifiÃ© et Ã©volutif**. Voici une vue d'ensemble :

- **Ancienne architecture :** ğŸ¯ Auparavant, Open WebUI Ã©tait construit sur une **architecture de sous-applications** oÃ¹ chaque application (par exemple, `ollama`, `openai`) Ã©tait une application FastAPI distincte. Cela provoquait une fragmentation et une complexitÃ© supplÃ©mentaire pour gÃ©rer les applications.
- **Nouvelle architecture :** ğŸš€ Avec la version 0.5, nous sommes passÃ©s Ã  une **application FastAPI unique** avec plusieurs **routeurs**. Cela signifie une meilleure organisation, un flux centralisÃ© et une rÃ©duction de la redondance.

### Changements clÃ©s :
Voici un aperÃ§u des modifications apportÃ©es :
1. **Les applications ont Ã©tÃ© transformÃ©es en routeurs.**
   - Avant : `open_webui.apps`
   - Maintenant : `open_webui.routers`

2. **Structure principale de l'application simplifiÃ©e.**
   - L'ancien `open_webui.apps.webui` a Ã©tÃ© transformÃ© en `open_webui.main`, ce qui en fait le point d'entrÃ©e central du projet.

3. **Point d'accÃ¨s API unifiÃ©**
   - Open WebUI 0.5 introduit une **fonction unifiÃ©e**, `chat_completion`, dans `open_webui.main`, remplaÃ§ant les fonctions sÃ©parÃ©es pour les modÃ¨les comme `ollama` et `openai`. Cela offre une expÃ©rience API cohÃ©rente et rationnelle. Cependant, le **successeur direct** de ces fonctions individuelles est `generate_chat_completion` de `open_webui.utils.chat`. Si vous prÃ©fÃ©rez une requÃªte POST lÃ©gÃ¨re sans gestion de parsing supplÃ©mentaire (par exemple, fichiers, outils ou divers), cette fonction utilitaire est probablement celle qu'il vous faut.

#### Exemple :
```python
# Flux API complet avec parsing (nouvelle fonction) :
from open_webui.main import chat_completion

# RequÃªte POST directe et lÃ©gÃ¨re (successeur direct) :
from open_webui.utils.chat import generate_chat_completion
```

Choisissez l'approche qui correspond le mieux Ã  votre cas d'utilisation !

4. **Signatures des fonctions mises Ã  jour.**
   - Les signatures des fonctions respectent dÃ©sormais un nouveau format, nÃ©cessitant un objet `request`.
   - L'objet `request` peut Ãªtre obtenu via le paramÃ¨tre `__request__` dans la signature de la fonction. Voici un exemple :

```python
class Pipe:
    def __init__(self):
        pass

    async def pipe(
        self,
        body: dict,
        __user__: dict,
        __request__: Request, # Nouveau paramÃ¨tre
    ) -> str:
        # Ã‰crivez votre fonction ici
```

ğŸ“Œ **Pourquoi avons-nous apportÃ© ces changements ?**
- Pour simplifier la base de code, la rendant plus facile Ã  Ã©tendre et Ã  maintenir.
- Pour unifier les APIs afin d'amÃ©liorer l'expÃ©rience des dÃ©veloppeurs.
- Pour amÃ©liorer les performances en consolidant les Ã©lÃ©ments redondants.

---

## âœ… Guide de Migration Ã‰tape par Ã‰tape

Suivez ce guide pour mettre Ã  jour votre projet en douceur.

---

### ğŸ”„ 1. Passage de `apps` Ã  `routers` 

Toutes les applications ont Ã©tÃ© renommÃ©es et dÃ©placÃ©es sous `open_webui.routers`. Cela affecte les imports dans votre code.

Changements rapides pour les chemins d'import :

| **Ancien Chemin**                | **Nouveau Chemin**                |
|----------------------------------|-----------------------------------|
| `open_webui.apps.ollama`         | `open_webui.routers.ollama`      |
| `open_webui.apps.openai`         | `open_webui.routers.openai`      |
| `open_webui.apps.audio`          | `open_webui.routers.audio`       |
| `open_webui.apps.retrieval`      | `open_webui.routers.retrieval`   |
| `open_webui.apps.webui`          | `open_webui.main`                 |


### ğŸ“œ Un Exemple Important  

Pour clarifier le cas particulier de l'application principale (`webui`), voici une rÃ¨gle simple :  

- **Ã‰tait dans `webui` ?** Ceci est maintenant dans la racine du projet ou dans `open_webui.main`.  
- Par exemple :  
    - **Avant (0.4) :**  
      ```python  
      from open_webui.apps.webui.models import SomeModel  
      ```  
    - **AprÃ¨s (0.5) :**  
      ```python  
      from open_webui.models import SomeModel  
      ```  

En gÃ©nÃ©ral, **remplacez simplement `open_webui.apps` par `open_webui.routers`â€”sauf pour `webui`, qui est maintenant `open_webui.main` !**


---

### ğŸ‘©â€ğŸ’» 2. Mise Ã  jour des dÃ©clarations d'importation

Voyons Ã  quoi ressemble cette mise Ã  jour dans votre code :

#### Avant :
```python
from open_webui.apps.ollama import main as ollama
from open_webui.apps.openai import main as openai
```

#### AprÃ¨s :
```python
# Imports de routeurs sÃ©parÃ©s
from open_webui.routers.ollama import generate_chat_completion
from open_webui.routers.openai import generate_chat_completion

# Ou utilisez le point d'accÃ¨s unifiÃ©
from open_webui.main import chat_completion
```

**ğŸ’¡ Conseil Pro :** Priorisez le point d'accÃ¨s unifiÃ© (`chat_completion`) pour plus de simplicitÃ© et de compatibilitÃ© future.

### ğŸ“ **Note supplÃ©mentaire : Choisir entre `main.chat_completion` et `utils.chat.generate_chat_completion`**

Selon votre cas d'utilisation, vous pouvez choisir entre :

1. **`open_webui.main.chat_completion` :**
    - Simule une requÃªte POST vers `/api/chat/completions`.
    - Traite les fichiers, outils et autres tÃ¢ches diverses.
    - IdÃ©al lorsque vous souhaitez que tout le flux de l'API soit gÃ©rÃ© automatiquement.

2. **`open_webui.utils.chat.generate_chat_completion` :**
    - Effectue directement une requÃªte POST sans gÃ©rer le traitement supplÃ©mentaire ou les tÃ¢ches.
    - C'est le **successeur direct** des fonctions prÃ©cÃ©dentes `main.generate_chat_completions`, `ollama.generate_chat_completion` et `openai.generate_chat_completion` dans Open WebUI 0.4.
    - IdÃ©al pour des scÃ©narios simplifiÃ©s et plus lÃ©gers.

#### Exemple :
```python
# Utilisez ceci pour le flux complet de l'API avec parsing :
from open_webui.main import chat_completion

# Utilisez ceci pour une requÃªte POST directe simplifiÃ©e :
from open_webui.utils.chat import generate_chat_completion
```

---

### ğŸ“‹ 3. S'adapter aux signatures de fonctions mises Ã  jour

Nous avons mis Ã  jour les **signatures des fonctions** pour mieux s'adapter Ã  la nouvelle architecture. Si vous recherchez un remplacement direct, commencez par la fonction utilitaire lÃ©gÃ¨re `generate_chat_completion` de `open_webui.utils.chat`. Pour le flux complet de l'API, utilisez la nouvelle fonction unifiÃ©e `chat_completion` dans `open_webui.main`.

#### Modifications des signatures de fonctions :

| **Ancien**                                 | **Successeur direct (Nouveau)**             | **Option UnifiÃ©e (Nouvelle)**               |
|--------------------------------------------|--------------------------------------------|---------------------------------------------|
| `openai.generate_chat_completion(form_data: dict, user: UserModel)` | `generate_chat_completion(request: Request, form_data: dict, user: UserModel)` | `chat_completion(request: Request, form_data: dict, user: UserModel)` |

- **Successeur direct (`generate_chat_completion`)** : Un remplacement simple et direct des anciennes mÃ©thodes `ollama`/`openai`.
- **Option unifiÃ©e (`chat_completion`)** : Utilisez ceci pour le flux complet de l'API, y compris le parsing de fichier et fonctionnalitÃ©s supplÃ©mentaires.

#### Exemple :

Si vous utilisez `chat_completion`, voici comment votre fonction devrait maintenant ressembler :

### ğŸ› ï¸ Comment refactoriser votre fonction personnalisÃ©e
RÃ©Ã©crivons une fonction exemple pour correspondre Ã  la nouvelle structure :

#### Avant (0.4) :
```python
from pydantic import BaseModel
from open_webui.apps.ollama import generate_chat_completion

class User(BaseModel):
    id: str
    email: str
    name: str
    role: str

class Pipe:
    def __init__(self):
        pass

    async def pipe(self, body: dict, __user__: dict) -> str:
        # Appelle le point de terminaison OpenAI
        user = User(**__user__)
        body["model"] = "llama3.2:latest"
        return await ollama.generate_chat_completion(body, user)
```

#### AprÃ¨s (0.5) :
```python
from pydantic import BaseModel
from fastapi import Request

from open_webui.utils.chat import generate_chat_completion


class User(BaseModel):
    id: str
    email: str
    name: str
    role: str


class Pipe:
    def __init__(self):
        pass

    async def pipe(
        self,
        body: dict,
        __user__: dict,
        __request__: Request,
    ) -> str:
        # Utilise le point de terminaison unifiÃ© avec signature mise Ã  jour
        user = User(**__user__)
        body["model"] = "llama3.2:latest"
        return await generate_chat_completion(__request__, body, user)
```

### Notes importantes :
- Vous devez passer un objet `Request` (`__request__`) dans la nouvelle signature de fonction.
- D'autres paramÃ¨tres optionnels (comme `__user__` et `__event_emitter__`) assurent une flexibilitÃ© pour des cas d'utilisation plus complexes.

---

### ğŸŒŸ 4. RÃ©capitulatif : Concepts clÃ©s en termes simples

Voici une fiche pratique pour se souvenir :
- **Applications vers Routeurs :** Mettez Ã  jour toutes les importations de `open_webui.apps` â¡ï¸ `open_webui.routers`.
- **Point de terminaison unifiÃ© :** Utilisez `open_webui.main.chat_completion` pour simplifier lorsque les deux `ollama` et `openai` sont impliquÃ©s.
- **Adapter les signatures des fonctions :** Assurez-vous que vos fonctions passent l'objet `request` requis.

---

## ğŸ‰ Hourra ! Vous Ãªtes prÃªt !

C'est fini ! Vous avez migrÃ© avec succÃ¨s de **Open WebUI 0.4 vers 0.5**. En refactorisant vos importations, en utilisant le point de terminaison unifiÃ© et en mettant Ã  jour les signatures de fonctions, vous serez pleinement Ã©quipÃ© pour exploiter les derniÃ¨res fonctionnalitÃ©s et amÃ©liorations de la version 0.5.

---

ğŸ’¬ **Questions ou retours d'expÃ©rience ?**
Si vous rencontrez des problÃ¨mes ou avez des suggestions, n'hÃ©sitez pas Ã  ouvrir un [issue GitHub](https://github.com/open-webui/open-webui) ou Ã  poser des questions dans les forums communautaires !

Bon codage ! âœ¨