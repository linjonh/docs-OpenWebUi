---
sidebar_position: 4
title: "üöö Migration des outils et fonctions : 0.4 vers 0.5"
---

# üöö Guide de Migration : Open WebUI 0.4 vers 0.5

Bienvenue dans le guide de migration d'Open WebUI 0.5 ! Que vous travailliez sur des projets existants ou en construisiez de nouveaux, ce guide vous expliquera les principaux changements entre les versions **0.4 et 0.5** et vous fournira une feuille de route facile √† suivre pour mettre √† jour vos fonctions. Rendons cette transition aussi fluide que possible ! üòä

---

## üßê Qu'est-ce qui a chang√© et pourquoi ?

Avec Open WebUI 0.5, nous avons repens√© l'architecture pour rendre le projet **plus simple, plus unifi√© et √©volutif**. Voici une vue d'ensemble :

- **Ancienne architecture :** üéØ Auparavant, Open WebUI √©tait construit sur une **architecture de sous-applications** o√π chaque application (par exemple, `ollama`, `openai`) √©tait une application FastAPI distincte. Cela provoquait une fragmentation et une complexit√© suppl√©mentaire pour g√©rer les applications.
- **Nouvelle architecture :** üöÄ Avec la version 0.5, nous sommes pass√©s √† une **application FastAPI unique** avec plusieurs **routeurs**. Cela signifie une meilleure organisation, un flux centralis√© et une r√©duction de la redondance.

### Changements cl√©s :
Voici un aper√ßu des modifications apport√©es :
1. **Les applications ont √©t√© transform√©es en routeurs.**
   - Avant : `open_webui.apps`
   - Maintenant : `open_webui.routers`

2. **Structure principale de l'application simplifi√©e.**
   - L'ancien `open_webui.apps.webui` a √©t√© transform√© en `open_webui.main`, ce qui en fait le point d'entr√©e central du projet.

3. **Point d'acc√®s API unifi√©**
   - Open WebUI 0.5 introduit une **fonction unifi√©e**, `chat_completion`, dans `open_webui.main`, rempla√ßant les fonctions s√©par√©es pour les mod√®les comme `ollama` et `openai`. Cela offre une exp√©rience API coh√©rente et rationnelle. Cependant, le **successeur direct** de ces fonctions individuelles est `generate_chat_completion` de `open_webui.utils.chat`. Si vous pr√©f√©rez une requ√™te POST l√©g√®re sans gestion de parsing suppl√©mentaire (par exemple, fichiers, outils ou divers), cette fonction utilitaire est probablement celle qu'il vous faut.

#### Exemple :
```python
# Flux API complet avec parsing (nouvelle fonction) :
from open_webui.main import chat_completion

# Requ√™te POST directe et l√©g√®re (successeur direct) :
from open_webui.utils.chat import generate_chat_completion
```

Choisissez l'approche qui correspond le mieux √† votre cas d'utilisation !

4. **Signatures des fonctions mises √† jour.**
   - Les signatures des fonctions respectent d√©sormais un nouveau format, n√©cessitant un objet `request`.
   - L'objet `request` peut √™tre obtenu via le param√®tre `__request__` dans la signature de la fonction. Voici un exemple :

```python
class Pipe:
    def __init__(self):
        pass

    async def pipe(
        self,
        body: dict,
        __user__: dict,
        __request__: Request, # Nouveau param√®tre
    ) -> str:
        # √âcrivez votre fonction ici
```

üìå **Pourquoi avons-nous apport√© ces changements ?**
- Pour simplifier la base de code, la rendant plus facile √† √©tendre et √† maintenir.
- Pour unifier les APIs afin d'am√©liorer l'exp√©rience des d√©veloppeurs.
- Pour am√©liorer les performances en consolidant les √©l√©ments redondants.

---

## ‚úÖ Guide de Migration √âtape par √âtape

Suivez ce guide pour mettre √† jour votre projet en douceur.

---

### üîÑ 1. Passage de `apps` √† `routers` 

Toutes les applications ont √©t√© renomm√©es et d√©plac√©es sous `open_webui.routers`. Cela affecte les imports dans votre code.

Changements rapides pour les chemins d'import :

| **Ancien Chemin**                | **Nouveau Chemin**                |
|----------------------------------|-----------------------------------|
| `open_webui.apps.ollama`         | `open_webui.routers.ollama`      |
| `open_webui.apps.openai`         | `open_webui.routers.openai`      |
| `open_webui.apps.audio`          | `open_webui.routers.audio`       |
| `open_webui.apps.retrieval`      | `open_webui.routers.retrieval`   |
| `open_webui.apps.webui`          | `open_webui.main`                 |


### üìú Un Exemple Important  

Pour clarifier le cas particulier de l'application principale (`webui`), voici une r√®gle simple :  

- **√âtait dans `webui` ?** Ceci est maintenant dans la racine du projet ou dans `open_webui.main`.  
- Par exemple :  
    - **Avant (0.4) :**  
      ```python  
      from open_webui.apps.webui.models import SomeModel  
      ```  
    - **Apr√®s (0.5) :**  
      ```python  
      from open_webui.models import SomeModel  
      ```  

En g√©n√©ral, **remplacez simplement `open_webui.apps` par `open_webui.routers`‚Äîsauf pour `webui`, qui est maintenant `open_webui.main` !**


---

### üë©‚Äçüíª 2. Mise √† jour des d√©clarations d'importation

Voyons √† quoi ressemble cette mise √† jour dans votre code :

#### Avant :
```python
from open_webui.apps.ollama import main as ollama
from open_webui.apps.openai import main as openai
```

#### Apr√®s :
```python
# Imports de routeurs s√©par√©s
from open_webui.routers.ollama import generate_chat_completion
from open_webui.routers.openai import generate_chat_completion

# Ou utilisez le point d'acc√®s unifi√©
from open_webui.main import chat_completion
```

**üí° Conseil Pro :** Priorisez le point d'acc√®s unifi√© (`chat_completion`) pour plus de simplicit√© et de compatibilit√© future.

### üìù **Note suppl√©mentaire : Choisir entre `main.chat_completion` et `utils.chat.generate_chat_completion`**

Selon votre cas d'utilisation, vous pouvez choisir entre :

1. **`open_webui.main.chat_completion` :**
    - Simule une requ√™te POST vers `/api/chat/completions`.
    - Traite les fichiers, outils et autres t√¢ches diverses.
    - Id√©al lorsque vous souhaitez que tout le flux de l'API soit g√©r√© automatiquement.

2. **`open_webui.utils.chat.generate_chat_completion` :**
    - Effectue directement une requ√™te POST sans g√©rer le traitement suppl√©mentaire ou les t√¢ches.
    - C'est le **successeur direct** des fonctions pr√©c√©dentes `main.generate_chat_completions`, `ollama.generate_chat_completion` et `openai.generate_chat_completion` dans Open WebUI 0.4.
    - Id√©al pour des sc√©narios simplifi√©s et plus l√©gers.

#### Exemple :
```python
# Utilisez ceci pour le flux complet de l'API avec parsing :
from open_webui.main import chat_completion

# Utilisez ceci pour une requ√™te POST directe simplifi√©e :
from open_webui.utils.chat import generate_chat_completion
```

---

### üìã 3. S'adapter aux signatures de fonctions mises √† jour

Nous avons mis √† jour les **signatures des fonctions** pour mieux s'adapter √† la nouvelle architecture. Si vous recherchez un remplacement direct, commencez par la fonction utilitaire l√©g√®re `generate_chat_completion` de `open_webui.utils.chat`. Pour le flux complet de l'API, utilisez la nouvelle fonction unifi√©e `chat_completion` dans `open_webui.main`.

#### Modifications des signatures de fonctions :

| **Ancien**                                 | **Successeur direct (Nouveau)**             | **Option Unifi√©e (Nouvelle)**               |
|--------------------------------------------|--------------------------------------------|---------------------------------------------|
| `openai.generate_chat_completion(form_data: dict, user: UserModel)` | `generate_chat_completion(request: Request, form_data: dict, user: UserModel)` | `chat_completion(request: Request, form_data: dict, user: UserModel)` |

- **Successeur direct (`generate_chat_completion`)** : Un remplacement simple et direct des anciennes m√©thodes `ollama`/`openai`.
- **Option unifi√©e (`chat_completion`)** : Utilisez ceci pour le flux complet de l'API, y compris le parsing de fichier et fonctionnalit√©s suppl√©mentaires.

#### Exemple :

Si vous utilisez `chat_completion`, voici comment votre fonction devrait maintenant ressembler :

### üõ†Ô∏è Comment refactoriser votre fonction personnalis√©e
R√©√©crivons une fonction exemple pour correspondre √† la nouvelle structure :

#### Avant (0.4) :
```python
from pydantic import BaseModel
from open_webui.apps.ollama import generate_chat_completion

class User(BaseModel):
    id: str
    email: str
    name: str
    role: str

class Pipe:
    def __init__(self):
        pass

    async def pipe(self, body: dict, __user__: dict) -> str:
        # Appelle le point de terminaison OpenAI
        user = User(**__user__)
        body["model"] = "llama3.2:latest"
        return await ollama.generate_chat_completion(body, user)
```

#### Apr√®s (0.5) :
```python
from pydantic import BaseModel
from fastapi import Request

from open_webui.utils.chat import generate_chat_completion


class User(BaseModel):
    id: str
    email: str
    name: str
    role: str


class Pipe:
    def __init__(self):
        pass

    async def pipe(
        self,
        body: dict,
        __user__: dict,
        __request__: Request,
    ) -> str:
        # Utilise le point de terminaison unifi√© avec signature mise √† jour
        user = User(**__user__)
        body["model"] = "llama3.2:latest"
        return await generate_chat_completion(__request__, body, user)
```

### Notes importantes :
- Vous devez passer un objet `Request` (`__request__`) dans la nouvelle signature de fonction.
- D'autres param√®tres optionnels (comme `__user__` et `__event_emitter__`) assurent une flexibilit√© pour des cas d'utilisation plus complexes.

---

### üåü 4. R√©capitulatif : Concepts cl√©s en termes simples

Voici une fiche pratique pour se souvenir :
- **Applications vers Routeurs :** Mettez √† jour toutes les importations de `open_webui.apps` ‚û°Ô∏è `open_webui.routers`.
- **Point de terminaison unifi√© :** Utilisez `open_webui.main.chat_completion` pour simplifier lorsque les deux `ollama` et `openai` sont impliqu√©s.
- **Adapter les signatures des fonctions :** Assurez-vous que vos fonctions passent l'objet `request` requis.

---

## üéâ Hourra ! Vous √™tes pr√™t !

C'est fini ! Vous avez migr√© avec succ√®s de **Open WebUI 0.4 vers 0.5**. En refactorisant vos importations, en utilisant le point de terminaison unifi√© et en mettant √† jour les signatures de fonctions, vous serez pleinement √©quip√© pour exploiter les derni√®res fonctionnalit√©s et am√©liorations de la version 0.5.

---

üí¨ **Questions ou retours d'exp√©rience ?**
Si vous rencontrez des probl√®mes ou avez des suggestions, n'h√©sitez pas √† ouvrir un [issue GitHub](https://github.com/open-webui/open-webui) ou √† poser des questions dans les forums communautaires !

Bon codage ! ‚ú®