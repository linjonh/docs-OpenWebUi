---
sidebar_position: 3
title: "‚õëÔ∏è Eventos"
---

# ‚õëÔ∏è Eventos: Utilizando `__event_emitter__` e `__event_call__` no Open WebUI

A arquitetura de plugins do Open WebUI n√£o se trata apenas de processar entrada e produzir sa√≠da‚Äî**√© sobre comunica√ß√£o interativa e em tempo real com a interface de usu√°rio e os usu√°rios**. Para tornar suas Ferramentas, Fun√ß√µes e Pipes mais din√¢micos, o Open WebUI fornece um sistema de eventos integrado por meio dos auxiliares `__event_emitter__` e `__event_call__`.

Este guia explica **o que s√£o eventos**, **como voc√™ pode acion√°-los** a partir do seu c√≥digo, e **todo o cat√°logo de tipos de eventos** que voc√™ pode usar (incluindo muito mais do que apenas `"input"`).

---

## üåä O que s√£o Eventos?

**Eventos** s√£o notifica√ß√µes em tempo real ou solicita√ß√µes interativas enviadas do seu c√≥digo backend (Ferramenta ou Fun√ß√£o) para a interface web. Eles permitem atualizar o chat, exibir notifica√ß√µes, solicitar confirma√ß√µes, executar fluxos de interface e muito mais.

- Os eventos s√£o enviados usando o auxiliar `__event_emitter__` para atualiza√ß√µes unidirecionais ou `__event_call__` quando voc√™ precisa de entrada ou resposta do usu√°rio (por exemplo, confirma√ß√£o, entrada, etc.).

**Met√°fora:**
Pense nos Eventos como notifica√ß√µes push e di√°logos modais que seu plugin pode acionar, tornando a experi√™ncia de bate-papo mais rica e interativa.

---

## üß∞ Uso B√°sico

### Enviando um Evento

Voc√™ pode acionar um evento em qualquer lugar dentro da sua Ferramenta ou Fun√ß√£o chamando:

```python
await __event_emitter__(
    {
        "type": "status",  # Veja a lista de tipos de eventos abaixo
        "data": {
            "description": "Processamento iniciado!",
            "done": False,
            "hidden": False,
        },
    }
)
```

Voc√™ **n√£o** precisa adicionar manualmente campos como `chat_id` ou `message_id`‚Äîesses s√£o gerenciados automaticamente pelo Open WebUI.

### Eventos Interativos

Quando voc√™ precisa pausar a execu√ß√£o at√© que o usu√°rio responda (por exemplo, di√°logos de confirmar/cancelar, execu√ß√£o de c√≥digo ou entrada), use `__event_call__`:

```python
result = await __event_call__(
    {
        "type": "input",  # Ou "confirmation", "execute"
        "data": {
            "title": "Por favor, insira sua senha",
            "message": "Senha √© necess√°ria para esta a√ß√£o",
            "placeholder": "Sua senha aqui",
        },
    }
)
# result conter√° o valor de entrada do usu√°rio
```

---

## üìú Estrutura de Payload de Evento

Ao emitir ou chamar um evento, a estrutura b√°sica √©:

```json
{
  "type": "event_type",   // Veja lista completa abaixo
  "data": { ... }         // Payload espec√≠fico do evento
}
```

Na maioria das vezes, voc√™ s√≥ define `"type"` e `"data"`. O Open WebUI preenche o roteamento automaticamente.

---

## üóÇ Lista Completa de Tipos de Eventos

Abaixo est√° uma tabela abrangente de **todos os valores suportados para `type`** para eventos, juntamente com seu efeito pretendido e a estrutura de payload de dados. (Isso se baseia na an√°lise atualizada da l√≥gica de manipula√ß√£o de eventos do Open WebUI.)

| tipo                        | Quando usar                                     | Estrutura do payload de dados (exemplos)                             |
|-----------------------------|------------------------------------------------|--------------------------------------------------------------------|
| `status`                    | Exibir uma atualiza√ß√£o de status/hist√≥rico de uma mensagem | `{description: ..., done: bool, hidden: bool}`                     |
| `chat:completion`           | Fornecer um resultado de conclus√£o de chat     | (Personalizado, veja os internos do Open WebUI)                    |
| `chat:message:delta`,<br/>`message` | Adicionar conte√∫do √† mensagem atual            | `{content: "texto para adicionar"}`                               |
| `chat:message`,<br/>`replace`        | Substituir completamente o conte√∫do da mensagem atual | `{content: "texto substitu√≠do"}`                                |
| `chat:message:files`,<br/>`files`   | Definir ou substituir os arquivos da mensagem (para uploads, sa√≠da) | `{files: [...]}`                                                 |
| `chat:title`                | Definir (ou atualizar) o t√≠tulo da conversa do chat | String de t√≥pico ou `{title: ...}`                               |
| `chat:tags`                 | Atualizar o conjunto de tags de um chat         | Array de tags ou objeto                                           |
| `source`,<br/>`citation`              | Adicionar uma fonte/cita√ß√£o ou resultado de execu√ß√£o de c√≥digo | Para c√≥digo: Veja [abaixo.](#code-execution-event)                |
| `notification`              | Exibir uma notifica√ß√£o ("toast") na interface do usu√°rio | `{type: "info" ou "success" ou "error" ou "warning", content: "..."}` |
| `confirmation` <br/>(necessita `__event_call__`) | Solicitar confirma√ß√£o (di√°logo OK/Cancelar)        | `{title: "...", message: "..."}`                              |
| `input` <br/>(necessita `__event_call__`)    | Solicitar entrada simples do usu√°rio (di√°logo "caixa de entrada") | `{title: "...", message: "...", placeholder: "...", value: ...}` |
| `execute` <br/>(necessita de `__event_call__`)  | Solicitar execu√ß√£o de c√≥digo no lado do usu√°rio e retornar o resultado  | `{code: "...c√≥digo javascript..."}`                                  |

**Outros/Tipos Avan√ßados:**

- Voc√™ pode definir seus pr√≥prios tipos e lidar com eles na camada de interface do usu√°rio (ou usar os pr√≥ximos mecanismos de extens√£o de eventos).

### ‚ùó Detalhes sobre Tipos de Evento Espec√≠ficos
### `status`

Mostrar uma atualiza√ß√£o de status/progress na interface do usu√°rio:

```python
await __event_emitter__(
    {
        "type": "status",
        "data": {
            "description": "Passo 1/3: Buscando dados...",
            "done": False,
            "hidden": False,
        },
    }
)
```

---

### `chat:message:delta` ou `message`

**Sa√≠da de streaming** (adicionar texto):

```python
await __event_emitter__(
    {
        "type": "chat:message:delta",  # ou simplesmente "message"
        "data": {
            "content": "Texto parcial, "
        },
    }
)

# Mais tarde, conforme voc√™ gera mais:
await __event_emitter__(
    {
        "type": "chat:message:delta",
        "data": {
            "content": "pr√≥ximo segmento da resposta."
        },
    }
)
```

---

### `chat:message` ou `replace`

**Definir (ou substituir) todo o conte√∫do da mensagem:**

```python
await __event_emitter__(
    {
        "type": "chat:message",  # ou "replace"
        "data": {
            "content": "Resposta final, completa."
        },
    }
)
```

---

### `files` ou `chat:message:files`

**Anexar ou atualizar arquivos:**

```python
await __event_emitter__(
    {
        "type": "files",  # ou "chat:message:files"
        "data": {
            "files": [
               # Objetos de Arquivo do Open WebUI
            ]
        },
    }
)
```

---

### `chat:title`

**Atualizar o t√≠tulo do chat:**

```python
await __event_emitter__(
    {
        "type": "chat:title",
        "data": {
            "title": "Sess√£o de Bot de An√°lise de Mercado"
        },
    }
)
```

---

### `chat:tags`

**Atualizar as tags do chat:**

```python
await __event_emitter__(
    {
        "type": "chat:tags",
        "data": {
            "tags": ["finan√ßas", "IA", "relat√≥rio di√°rio"]
        },
    }
)
```

---

### `source` ou `citation` (e execu√ß√£o de c√≥digo)

**Adicionar uma refer√™ncia/cita√ß√£o:**

```python
await __event_emitter__(
    {
        "type": "source",  # ou "citation"
        "data": {
            # Objeto de Fonte (Cita√ß√£o) do Open WebUI
        }
    }
)
```

**Para execu√ß√£o de c√≥digo (rastrear estado de execu√ß√£o):**

```python
await __event_emitter__(
    {
        "type": "source",
        "data": {
            # Objeto de C√≥digo Fonte (Cita√ß√£o) do Open WebUI
        }
    }
)
```

---

### `notification`

**Mostrar uma notifica√ß√£o de alerta:**

```python
await __event_emitter__(
    {
        "type": "notification",
        "data": {
            "type": "info",  # "success", "warning", "error"
            "content": "A opera√ß√£o foi conclu√≠da com sucesso!"
        }
    }
)
```

---

### `confirmation` (**requer** `__event_call__`)

**Mostrar um di√°logo de confirma√ß√£o e obter resposta do usu√°rio:**

```python
result = await __event_call__(
    {
        "type": "confirmation",
        "data": {
            "title": "Voc√™ tem certeza?",
            "message": "Voc√™ realmente deseja continuar?"
        }
    }
)

if result:  # ou verificar o conte√∫do do resultado
    await __event_emitter__({
        "type": "notification",
        "data": {"type": "success", "content": "Usu√°rio confirmou a opera√ß√£o."}
    })
else:
    await __event_emitter__({
        "type": "notification",
        "data": {"type": "warning", "content": "Usu√°rio cancelou."}
    })
```

---

### `input` (**requer** `__event_call__`)

**Solicitar entrada de texto do usu√°rio:**

```python
result = await __event_call__(
    {
        "type": "input",
        "data": {
            "title": "Digite seu nome",
            "message": "Precisamos do seu nome para continuar.",
            "placeholder": "Seu nome completo"
        }
    }
)

user_input = result
await __event_emitter__(
    {
        "type": "notification",
        "data": {"type": "info", "content": f"Voc√™ inseriu: {user_input}"}
    }
)
```

---

### `execute` (**requer** `__event_call__`)

**Executar c√≥digo dinamicamente no lado do usu√°rio:**

```python
result = await __event_call__(
    {
        "type": "execute",
        "data": {
            "code": "print(40 + 2);",
        }
    }
)

await __event_emitter__(
    {
        "type": "notification",
        "data": {
            "type": "info",
            "content": f"C√≥digo executado, resultado: {result}"
        }
    }
)
```

---

## üèóÔ∏è Quando e Onde Usar Eventos

- **De qualquer Ferramenta ou Fun√ß√£o** no Open WebUI.
- Para **respostas em streaming**, mostrar progresso, solicitar dados do usu√°rio, atualizar a interface do usu√°rio ou exibir informa√ß√µes/suplementos.
- `await __event_emitter__` √© para mensagens unilaterais (enviar e esquecer).
- `await __event_call__` √© para quando voc√™ precisa de uma resposta do usu√°rio (entrada, executar, confirma√ß√£o).

---

## üí° Dicas e Notas Avan√ßadas

- **M√∫ltiplos tipos por mensagem:** Voc√™ pode emitir v√°rios eventos de diferentes tipos para uma mensagem‚Äîpor exemplo, mostrar atualiza√ß√µes de `status`, depois transmitir com `chat:message:delta`, e completar com um `chat:message`.
- **Tipos personalizados de eventos:** Embora a lista acima seja padr√£o, voc√™ pode usar seus pr√≥prios tipos e detectar/lidar com eles em c√≥digo personalizado de interface.
- **Extensibilidade:** O sistema de eventos √© projetado para evoluir‚Äîsempre confira a [documenta√ß√£o do Open WebUI](https://github.com/open-webui/open-webui) para a lista mais atual e uso avan√ßado.

---

## üßê FAQ

### Q: Como fa√ßo para disparar uma notifica√ß√£o para o usu√°rio?
Use o tipo `notification`:
```python
await __event_emitter__({
    "type": "notification",
    "data": {"type": "success", "content": "Tarefa conclu√≠da"}
})
```

### Q: Como fa√ßo para solicitar entrada do usu√°rio e obter a resposta dele?
Use:
```python
response = await __event_call__({
    "type": "input",
    "data": {
        "title": "Qual √© o seu nome?",
        "message": "Por favor, insira o nome que prefere:",
        "placeholder": "Nome"
    }
})
# response ser√°: {"value": "resposta do usu√°rio"}
```

### Q: Quais tipos de evento est√£o dispon√≠veis para `__event_call__`?
- `"input"`: Caixa de di√°logo para entrada
- `"confirmation"`: Di√°logo Sim/N√£o, OK/Cancelar
- `"execute"`: Executar c√≥digo fornecido no cliente e retornar resultado

### Q: Posso atualizar arquivos anexados a uma mensagem?
Sim‚Äîuse o tipo de evento `"files"` ou `"chat:message:files"` com um payload `{files: [...]}`.

### Q: Posso atualizar o t√≠tulo ou tags da conversa?
Claro: use `"chat:title"` ou `"chat:tags"` conforme necess√°rio.

### Q: Posso transmitir respostas (tokens parciais) para o usu√°rio?
Sim‚Äîemita eventos `"chat:message:delta"` em um loop e finalize com `"chat:message"`.

---

## üìù Conclus√£o

**Eventos** oferecem a voc√™ superpoderes interativos e em tempo real dentro do Open WebUI. Eles permitem que seu c√≥digo atualize conte√∫do, dispare notifica√ß√µes, solicite entrada do usu√°rio, transmita resultados, manipule c√≥digo e muito mais‚Äîintegrando perfeitamente a intelig√™ncia do seu backend √† interface de chat.

- Use `__event_emitter__` para atualiza√ß√µes de status/conte√∫do unidirecionais.
- Use `__event_call__` para intera√ß√µes que exigem acompanhamento do usu√°rio (entrada, confirma√ß√£o, execu√ß√£o).

Consulte este documento para tipos de eventos comuns e estruturas, e explore o c√≥digo-fonte ou documenta√ß√£o do Open WebUI para novidades ou eventos personalizados!

---

**Feliz codifica√ß√£o orientada por eventos no Open WebUI! üöÄ**