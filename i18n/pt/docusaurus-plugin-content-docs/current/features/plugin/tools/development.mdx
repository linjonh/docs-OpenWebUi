---
sidebar_position: 2
title: "üõ†Ô∏è Desenvolvimento"
---



## Escrevendo Um Toolkit Customizado

Toolkits s√£o definidos em um √∫nico arquivo Python, com uma string de documenta√ß√£o no n√≠vel superior contendo metadados e uma classe `Tools`.

### Exemplo de String de Documenta√ß√£o de N√≠vel Superior

```python
"""
title: Inverso de String
author: Seu Nome
author_url: https://website.com
git_url: https://github.com/username/string-reverse.git
description: Esta ferramenta calcula o inverso de uma string
required_open_webui_version: 0.4.0
requirements: langchain-openai, langgraph, ollama, langchain_ollama
version: 0.4.0
licence: MIT
"""
```

### Classe de Ferramentas

Ferramentas devem ser definidas como m√©todos dentro de uma classe chamada `Tools`, com subclasses opcionais chamadas `Valves` e `UserValves`, por exemplo:

```python
class Tools:
    def __init__(self):
        """Inicializa a Ferramenta."""
        self.valves = self.Valves()

    class Valves(BaseModel):
        api_key: str = Field("", description="Sua chave API aqui")

    def reverse_string(self, string: str) -> str:
        """
        Reverte a string de entrada.
        :param string: A string a ser revertida
        """
        # exemplo de uso de v√°lvulas
        if self.valves.api_key != "42":
            return "Chave API incorreta"
        return string[::-1] 
```

### Anota√ß√µes de Tipos
Cada ferramenta deve ter anota√ß√µes de tipo para os argumentos. Os tipos tamb√©m podem ser aninhados, como `queries_and_docs: list[tuple[str, int]]`. Essas anota√ß√µes de tipos s√£o usadas para gerar o esquema JSON que √© enviado ao modelo. Ferramentas sem anota√ß√µes de tipo funcionar√£o com muito menos consist√™ncia.

### Valves e UserValves - (opcional, mas ALTAMENTE recomendados)

Valves e UserValves s√£o usados para especificar configura√ß√µes personaliz√°veis da Ferramenta, voc√™ pode ler mais na p√°gina dedicada [Valves & UserValves](../valves/index.mdx).

### Argumentos Opcionais
Abaixo est√° uma lista de argumentos opcionais dos quais suas ferramentas podem depender:
- `__event_emitter__`: Emite eventos (veja a se√ß√£o seguinte)
- `__event_call__`: O mesmo que o emissor de eventos, mas pode ser usado para intera√ß√µes do usu√°rio
- `__user__`: Um dicion√°rio com informa√ß√µes do usu√°rio. Ele tamb√©m cont√©m o objeto `UserValves` em `__user__["valves"]`.
- `__metadata__`: Dicion√°rio com metadados do chat
- `__messages__`: Lista de mensagens anteriores
- `__files__`: Arquivos anexados
- `__model__`: Um dicion√°rio com informa√ß√µes do modelo

Basta adicion√°-los como argumentos a qualquer m√©todo da sua classe Tool como `__user__` no exemplo acima.

### Emissores de Eventos
Emissores de Eventos s√£o usados para adicionar informa√ß√µes adicionais √† interface de chat. Similar aos Filter Outlets, Emissores de Eventos s√£o capazes de anexar conte√∫do ao chat. Diferentemente dos Filter Outlets, eles n√£o s√£o capazes de remover informa√ß√µes. Al√©m disso, emissores podem ser ativados em qualquer est√°gio durante o uso da Ferramenta.

Existem dois tipos diferentes de Emissores de Eventos:

Se o modelo parecer incapaz de chamar a ferramenta, certifique-se de que ela est√° habilitada (via a p√°gina do Modelo ou via o sinal `+` ao lado do campo de entrada do chat). Voc√™ tamb√©m pode alterar o argumento `Function Calling` da se√ß√£o `Advanced Params` da p√°gina do Modelo de `Default` para `Native`.

#### Status
Isso √© usado para adicionar status a uma mensagem enquanto ela realiza etapas. Isso pode ser feito em qualquer est√°gio ao longo do uso da Ferramenta. Esses status aparecem logo acima do conte√∫do da mensagem. Eles s√£o muito √∫teis para Ferramentas que atrasam a resposta do LLM ou processam grandes quantidades de informa√ß√µes. Isso permite informar usu√°rios sobre o que est√° sendo processado em tempo real.

```python
await __event_emitter__(
            {
                "type": "status", # Configuramos o tipo aqui
                "data": {"description": "Mensagem que aparece no chat", "done": False, "hidden": False}, 
                # Note que done √© False aqui, indicando que ainda estamos emitindo status
            }
        )
```

<details>
<summary>Exemplo</summary>

```python
async def test_function(
        self, prompt: str, __user__: dict, __event_emitter__=None
    ) -> str:
        """
        Isso √© um demo

        :param test: isto √© um par√¢metro de teste
        """

        await __event_emitter__(
            {
                "type": "status", # Configuramos o tipo aqui
                "data": {"description": "Mensagem que aparece no chat", "done": False}, 
                # Note que done √© False aqui, indicando que ainda estamos emitindo status
            }
        )

        # Realize algum outro processamento aqui
        await __event_emitter__(
            {
                "type": "status",
                "data": {"description": "Mensagem de tarefa conclu√≠da", "done": True, "hidden": False},
                # Note que done √© True aqui, indicando que conclu√≠mos a emiss√£o de status
                # Voc√™ tamb√©m pode definir "hidden": True se quiser remover o status assim que a mensagem for retornada
            }
        )

        except Exception as e:
            await __event_emitter__(
                {
                    "type": "status",
                    "data": {"description": f"Ocorreu um erro: {e}", "done": True},
                }
            )

            return f"Informe ao usu√°rio: {e}"
```
</details>

#### Mensagem
Este tipo √© usado para anexar uma mensagem ao LLM em qualquer est√°gio da Ferramenta. Isso significa que voc√™ pode anexar mensagens, incorporar imagens e at√© mesmo renderizar p√°ginas da web antes, durante ou ap√≥s a resposta do LLM.

```python
await __event_emitter__(
                    {
                        "type": "message", # Definimos o tipo aqui
                        "data": {"content": "Esta mensagem ser√° anexada ao chat."},
                        # Observe que com os tipos de mensagem N√ÉO precisamos definir uma condi√ß√£o de conclus√£o
                    }
                )
```

<details>
<summary>Exemplo</summary>

```python
async def test_function(
        self, prompt: str, __user__: dict, __event_emitter__=None
    ) -> str:
        """
        Este √© um exemplo

        :param test: este √© um par√¢metro de teste
        """

        await __event_emitter__(
                    {
                        "type": "message", # Definimos o tipo aqui
                        "data": {"content": "Esta mensagem ser√° anexada ao chat."},
                        # Observe que com os tipos de mensagem N√ÉO precisamos definir uma condi√ß√£o de conclus√£o
                    }
                )

        except Exception as e:
            await __event_emitter__(
                {
                    "type": "status",
                    "data": {"description": f"Ocorreu um erro: {e}", "done": True},
                }
            )

            return f"Informe ao usu√°rio: {e}"
```
</details>

#### Cita√ß√µes
Este tipo √© usado para fornecer cita√ß√µes ou refer√™ncias no chat. Voc√™ pode utiliz√°-lo para especificar o conte√∫do, a fonte e qualquer metadado relevante. Abaixo est√° um exemplo de como emitir um evento de cita√ß√£o:

```python
await __event_emitter__(
    {
        "type": "citation",
        "data": {
            "document": [content],
            "metadata": [
                {
                    "date_accessed": datetime.now().isoformat(),
                    "source": title,
                }
            ],
            "source": {"name": title, "url": url},
        },
    }
)
```
Se voc√™ estiver enviando m√∫ltiplas cita√ß√µes, pode iterar sobre elas e chamar o emissor v√°rias vezes. Ao implementar cita√ß√µes personalizadas, certifique-se de definir `self.citation = False` no m√©todo `__init__` da sua classe `Tools`. Caso contr√°rio, as cita√ß√µes incorporadas substituir√£o as que voc√™ incorporou. Por exemplo:

```python
def __init__(self):
    self.citation = False
```

Aviso: se voc√™ definir `self.citation = True`, isso substituir√° quaisquer cita√ß√µes personalizadas que voc√™ enviar pela cita√ß√£o gerada automaticamente. Desativando-a, voc√™ poder√° gerenciar completamente suas pr√≥prias refer√™ncias de cita√ß√£o.

<details>
<summary>Exemplo</summary>

```python
class Tools:
    class UserValves(BaseModel):
        test: bool = Field(
            default=True, description="teste"
        )

    def __init__(self):
        self.citation = False

async def test_function(
        self, prompt: str, __user__: dict, __event_emitter__=None
    ) -> str:
        """
        Este √© um exemplo que apenas cria uma cita√ß√£o

        :param test: este √© um par√¢metro de teste
        """

        await __event_emitter__(
            {
                "type": "citation",
                "data": {
                    "document": ["Esta mensagem ser√° anexada ao chat como uma cita√ß√£o quando clicada"],
                    "metadata": [
                        {
                            "date_accessed": datetime.now().isoformat(),
                            "source": title,
                        }
                    ],
                    "source": {"name": "T√≠tulo do conte√∫do", "url": "http://link-para-citacao"},
                },
            }
        )
```
</details>

## Pacotes externos

Na defini√ß√£o de metadados das Ferramentas, voc√™ pode especificar pacotes personalizados. Quando voc√™ clicar em `Salvar`, a linha ser√° analisada e `pip install` ser√° executado em todos os requisitos de uma vez.

Lembre-se de que, como o pip √© usado no mesmo processo do Open WebUI, a interface ficar√° completamente sem resposta durante a instala√ß√£o.

Nenhuma medida √© tomada para lidar com conflitos de pacotes com os requisitos do Open WebUI. Isso significa que especificar requisitos pode quebrar o Open WebUI se voc√™ n√£o tiver cuidado. Voc√™ pode contornar isso especificando o pr√≥prio `open-webui` como um requisito.


<details>
<summary>Exemplo</summary>

```python
"""
t√≠tulo: meuNomeDaFerramenta
autor: meuNome
url_financiamento: [qualquer link aqui ser√° mostrado atr√°s de um bot√£o `Cora√ß√£o` para que os usu√°rios possam mostrar seu suporte a voc√™]
vers√£o: 1.0.0
# a vers√£o √© exibida na interface para ajudar os usu√°rios a acompanhar as atualiza√ß√µes.
licen√ßa: GPLv3
descri√ß√£o: [recomendado]
requisitos: pacote1>=2.7.0,pacote2,pacote3
"""
```

</details>
