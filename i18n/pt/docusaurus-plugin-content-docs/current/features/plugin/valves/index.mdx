---
sidebar_position: 3
title: "üîÑ V√°lvulas"
---

## V√°lvulas

As v√°lvulas e UserValves s√£o usadas para permitir que os usu√°rios forne√ßam detalhes din√¢micos, como uma chave de API ou uma op√ß√£o de configura√ß√£o. Estas criar√£o um campo preench√≠vel ou um interruptor bool no menu GUI para a fun√ß√£o fornecida. Elas sempre s√£o opcionais, mas ALTAMENTE recomendadas.

Portanto, as classes Valves e UserValves podem ser definidas em uma classe `Pipe`, `Pipeline`, `Filter` ou `Tools`.

As v√°lvulas s√£o configur√°veis apenas por administradores atrav√©s dos menus Tools ou Functions. Por outro lado, as UserValves s√£o configur√°veis por qualquer usu√°rio diretamente de uma sess√£o de chat.

<details>
<summary>Exemplo comentado</summary>

```python

from pydantic import BaseModel, Field
from typing import Literal

# Define e v√°lvulas
class Filter:
   # Observe a indenta√ß√£o atual: v√°lvulas e UserValves devem ser declaradas como
   # atributos de uma classe Tools, Filter ou Pipe. Aqui tomamos o
   # exemplo de um Filter.
    class Valves(BaseModel):
       # V√°lvulas e UserValves herdam de BaseModel do pydantic. Isso
       # permite casos de uso complexos como validadores de modelo, etc.
       test_valve: int = Field(  # Observe a dica de tipo: √© usada para
           # escolher o tipo de elemento UI para mostrar ao usu√°rio (bot√µes,
           # textos, etc).
           default=4,
           description="Uma v√°lvula controlando um valor num√©rico"
           # required=False,  # voc√™ pode impor campos usando True
       )
       # Para dar ao usu√°rio a escolha entre v√°rias strings, voc√™ pode usar Literal do typing:
       choice_option: Literal["choiceA", "choiceB"] = Field(
           default="choiceA",
           description="Um exemplo de uma v√°lvula de m√∫ltipla escolha",
       )
       priority: int = Field(
           default=0,
           description="N√≠vel de prioridade para as opera√ß√µes do filtro. Valores menores s√£o processados primeiro"
       )
       # O campo de prioridade √© opcional, mas se presente ser√° usado para
       # ordenar os filtros.
       pass
       # Note que este 'pass' ajuda na an√°lise e √© recomendado.

   # UserValves s√£o definidos da mesma maneira.
    class UserValves(BaseModel):
        test_user_valve: bool = Field(
            default=False, description="Uma v√°lvula de usu√°rio controlando uma chave de verdadeiro/falso (ligado/desligado)"
       )
       pass

   def __init__(self):
       self.valves = self.Valves()
       # Porque s√£o configurados pelo administrador, s√£o acess√≠veis diretamente
       # na execu√ß√£o do c√≥digo.
       pass

   # O m√©todo inlet √© usado apenas para Filter, mas o manuseio de __user__ √© o mesmo
   def inlet(self, body: dict, __user__: dict):
       # Porque UserValves s√£o definidos por usu√°rio, est√£o dispon√≠veis apenas
       # no uso.
       # Note que embora __user__ seja um dict, __user__["valves"] √© um
       # objeto UserValves. Portanto, voc√™ pode acessar os valores assim:
       test_user_valve = __user__["valves"].test_user_valve
       # Ou:
       test_user_valve = dict(__user__["valves"])["test_user_valve"]
       # Mas isso retornar√° o valor padr√£o ao inv√©s do valor real:
       # test_user_valve = __user__["valves"]["test_user_valve"]  # N√£o fa√ßa isso!
```

</details>
