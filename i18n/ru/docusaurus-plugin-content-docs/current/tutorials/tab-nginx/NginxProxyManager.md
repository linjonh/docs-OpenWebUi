### Nginx Proxy Manager

Nginx Proxy Manager (NPM) позволяет легко управлять обратными прокси и защищать ваши локальные приложения, такие как Open WebUI, с помощью действительных SSL-сертификатов от Lets Encrypt.
Эта настройка обеспечивает доступ по HTTPS, который необходим для использования функций голосового ввода на многих мобильных браузерах из-за требований безопасности, без прямого доступа к конкретному порту приложения в интернете.

#### Требования

- Домашний сервер с установленным Docker и запущенным контейнером open-webui.
- Имя домена (например, бесплатные варианты, такие как DuckDNS, или платные, такие как Namecheap/GoDaddy).
- Базовые знания о Docker и настройке DNS.

#### Шаги

1. **Создание директорий для файлов Nginx:**

    ```bash
    mkdir ~/nginx_config
    cd ~/nginx_config
    ```

2. **Настройка Nginx Proxy Manager с помощью Docker:**

    ```bash
    nano docker-compose.yml
    ```

```yaml
services:
  app:
    image: jc21/nginx-proxy-manager:latest
    restart: unless-stopped
    ports:
      - 80:80
      - 81:81
      - 443:443
    volumes:
      - ./data:/data
      - ./letsencrypt:/etc/letsencrypt
```

Запустите контейнер:
```bash
docker-compose up -d
```
3. **Настройка DNS и домена:**

    * Войдите в систему вашего провайдера домена (например, DuckDNS) и создайте домен.
    * Направьте домен на локальный IP вашего прокси (например, 192.168.0.6).
    * Если вы используете DuckDNS, получите API-токен на их панели управления.

###### Вот простой пример, как это делается на https://www.duckdns.org/domains :
    
4. **Настройка SSL-сертификатов:**
* Перейдите на Nginx Proxy Manager по адресу http://server_ip:81. Например: ``192.168.0.6:81``
* Войдите с учетными данными по умолчанию (admin@example.com / changeme). Измените их, как будет предложено.
* Перейдите в SSL-сертификаты → Добавить SSL-сертификат → Lets Encrypt.
* Введите ваш email и доменное имя, которое вы получили от DuckDNS. Один домен содержит звездочку, другой - нет. Пример: ``*.hello.duckdns.org`` и ``hello.duckdns.org``.
* Выберите Использовать DNS challenge, выберите DuckDNS и вставьте ваш API-токен. пример: 
```dns_duckdns_token=f4e2a1b9-c78d-e593-b0d7-67f2e1c9a5b8```
* Согласитесь с условиями Lets Encrypt и сохраните. Измените время распространения **если нужно** (120 секунд).

5. **Создание прокси-хостов:**
* Для каждого сервиса (например, openwebui, nextcloud), перейдите в Hosts → Proxy Hosts → Add Proxy Host.
* Заполните имя домена (например, openwebui.hello.duckdns.org).
* Установите схему в HTTP (по умолчанию), включите ``Websockets support`` и укажите IP вашего Docker (если Docker с open-webui запущен на том же компьютере, что и NGINX manager, это будет тот же IP, что и раньше (пример: ``192.168.0.6``)
* Выберите SSL-сертификат, который был создан ранее, включите SSL, и активируйте HTTP/2.
6. **Добавьте ваш URL в open-webui (иначе будет ошибка HTTPS):**

* Перейдите в ваш open-webui → Admin Panel → Settings → General
* В текстовом поле **Webhook URL** введите URL, через который вы будете подключаться к вашему open-webui через обратный прокси Nginx. Пример: ``hello.duckdns.org`` (не обязательно для этого) или ``openwebui.hello.duckdns.org`` (обязательно для этого).

#### Доступ к WebUI:

Получите доступ к Open WebUI через HTTPS по адресу ``hello.duckdns.org`` или ``openwebui.hello.duckdns.org`` (в зависимости от вашей настройки).

###### Заметка о файерволе: Учтите, что локальное программное обеспечение файервола (например, Portmaster) может блокировать внутренний сетевой трафик Docker или необходимые порты. Если у вас есть проблемы, проверьте правила файервола, чтобы обеспечить необходимую связь для этой настройки.
